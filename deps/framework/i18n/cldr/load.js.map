{"version":3,"file":"load.js","sourceRoot":"","sources":["load.ts"],"names":[],"mappings":"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","sourcesContent":["// required for Globalize/Cldr to properly resolve locales in the browser.\nimport * as GlobalizeType from 'globalize';\nimport 'cldrjs/dist/cldr/unresolved';\nimport supportedLocales from './locales';\nimport { generateLocales, validateLocale } from '../util/main';\n\n// TODO: use normal imports after landing https://github.com/DefinitelyTyped/DefinitelyTyped/pull/27271\nconst Globalize: typeof GlobalizeType = require('globalize/dist/globalize');\n\nexport interface CldrData {\n\tmain?: LocaleData;\n\tsupplemental?: any;\n}\n\nexport type CldrGroup = 'main' | 'supplemental';\n\nexport interface LocaleData {\n\t[locale: string]: any;\n}\n\n/**\n * A list of all required CLDR packages for an individual locale.\n */\nexport const mainPackages = Object.freeze([\n\t'dates/calendars/gregorian',\n\t'dates/fields',\n\t'dates/timeZoneNames',\n\t'numbers',\n\t'numbers/currencies',\n\t'units'\n]);\n\n/**\n * A list of all required CLDR supplement packages.\n */\nexport const supplementalPackages = Object.freeze([\n\t'currencyData',\n\t'likelySubtags',\n\t'numberingSystems',\n\t'plurals-type-cardinal',\n\t'plurals-type-ordinal',\n\t'timeData',\n\t'weekData'\n]);\n\n/**\n * @private\n * A simple map containing boolean flags indicating whether a particular CLDR package has been loaded.\n */\nconst loadCache = {\n\tmain: Object.create(null),\n\tsupplemental: generateSupplementalCache()\n};\n\n/**\n * @private\n * Generate the locale-specific data cache from a list of keys. Nested objects will be generated from\n * slash-separated strings.\n *\n * @param cache\n * An empty locale cache object.\n *\n * @param keys\n * The list of keys.\n */\nfunction generateLocaleCache(cache: any, keys: ReadonlyArray<string>) {\n\treturn keys.reduce((tree: any, key: string) => {\n\t\tconst parts = key.split('/');\n\n\t\tif (parts.length === 1) {\n\t\t\ttree[key] = false;\n\t\t\treturn tree;\n\t\t}\n\n\t\tparts.reduce((tree: any, key: string, i: number) => {\n\t\t\tif (typeof tree[key] !== 'object') {\n\t\t\t\ttree[key] = i === parts.length - 1 ? false : Object.create(null);\n\t\t\t}\n\t\t\treturn tree[key];\n\t\t}, tree);\n\n\t\treturn tree;\n\t}, cache);\n}\n\n/**\n * @private\n * Generate the supplemental data cache.\n */\nfunction generateSupplementalCache() {\n\treturn supplementalPackages.reduce((map: any, key: string) => {\n\t\tmap[key] = false;\n\t\treturn map;\n\t}, Object.create(null));\n}\n\n/**\n * @private\n * Recursively determine whether a list of packages have been loaded for the specified CLDR group.\n *\n * @param group\n * The CLDR group object (e.g., the supplemental data, or a specific locale group)\n *\n * @param args\n * A list of keys to recursively check from left to right. For example, if [ \"en\", \"numbers\" ],\n * then `group.en.numbers` must exist for the test to pass.\n *\n * @return\n * `true` if the deepest value exists; `false` otherwise.\n */\nfunction isLoadedForGroup(group: any, args: string[]) {\n\treturn args.every((arg: string) => {\n\t\tconst next = group[arg];\n\t\tgroup = next;\n\t\treturn Boolean(next);\n\t});\n}\n\n/**\n * @private\n * Recursively flag as loaded all recognized keys on the provided CLDR data object.\n *\n * @param cache\n * The load cache (either the entire object, or a nested segment of it).\n *\n * @param localeData\n * The CLDR data object being loaded (either the entire object, or a nested segment of it).\n */\nfunction registerLocaleData(cache: any, localeData: any) {\n\tObject.keys(localeData).forEach((key: string) => {\n\t\tif (key in cache) {\n\t\t\tconst value = cache[key];\n\n\t\t\tif (typeof value === 'boolean') {\n\t\t\t\tcache[key] = true;\n\t\t\t} else {\n\t\t\t\tregisterLocaleData(value, localeData[key]);\n\t\t\t}\n\t\t}\n\t});\n}\n\n/**\n * @private\n * Flag all supplied CLDR packages for a specific locale as loaded.\n *\n * @param data\n * The `main` locale data.\n */\nfunction registerMain(data?: LocaleData) {\n\tif (!data) {\n\t\treturn;\n\t}\n\n\tObject.keys(data).forEach((locale: string) => {\n\t\tif (supportedLocales.indexOf(locale) < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet loadedData = loadCache.main[locale];\n\t\tif (!loadedData) {\n\t\t\tloadedData = loadCache.main[locale] = generateLocaleCache(Object.create(null), mainPackages);\n\t\t}\n\n\t\tregisterLocaleData(loadedData, data[locale]);\n\t});\n}\n\n/**\n * @private\n * Flag all supplied CLDR supplemental packages as loaded.\n *\n * @param data\n * The supplemental data.\n */\nfunction registerSupplemental(data?: any) {\n\tif (!data) {\n\t\treturn;\n\t}\n\n\tconst supplemental = loadCache.supplemental;\n\tObject.keys(data).forEach((key: string) => {\n\t\tif (key in supplemental) {\n\t\t\tsupplemental[key] = true;\n\t\t}\n\t});\n}\n\n/**\n * Determine whether a particular CLDR package has been loaded.\n *\n * Example: to check that `supplemental.likelySubtags` has been loaded, `isLoaded` would be called as\n * `isLoaded('supplemental', 'likelySubtags')`.\n *\n * @param groupName\n * The group to check; either \"main\" or \"supplemental\".\n *\n * @param ...args\n * Any remaining keys in the path to the desired package.\n *\n * @return\n * `true` if the deepest value exists; `false` otherwise.\n */\nexport function isLoaded(groupName: CldrGroup, ...args: string[]) {\n\tlet group: any = loadCache[groupName];\n\n\tif (groupName === 'main' && args.length > 0) {\n\t\tconst locale = args[0];\n\n\t\tif (!validateLocale(locale)) {\n\t\t\treturn false;\n\t\t}\n\n\t\targs = args.slice(1);\n\t\treturn generateLocales(locale).some((locale: string) => {\n\t\t\tconst next = group[locale];\n\t\t\treturn next ? isLoadedForGroup(next, args) : false;\n\t\t});\n\t}\n\n\treturn isLoadedForGroup(group, args);\n}\n\n/**\n * Load the specified CLDR data with the i18n ecosystem.\n *\n * @param data\n * A data object containing `main` and/or `supplemental` objects with CLDR data.\n */\nexport default function loadCldrData(data: CldrData): Promise<void> {\n\tregisterMain(data.main);\n\tregisterSupplemental(data.supplemental);\n\tGlobalize.load(data);\n\treturn Promise.resolve();\n}\n\n/**\n * Clear the load cache, either the entire cache for the specified group. After calling this method,\n * `isLoaded` will return false for keys within the specified group(s).\n *\n * @param group\n * An optional group name. If not provided, then both the \"main\" and \"supplemental\" caches will be cleared.\n */\nexport function reset(group?: CldrGroup) {\n\tif (group !== 'supplemental') {\n\t\tloadCache.main = Object.create(null);\n\t}\n\n\tif (group !== 'main') {\n\t\tloadCache.supplemental = generateSupplementalCache();\n\t}\n}\n"]}