{"version":3,"file":"node.mjs","sourceRoot":"","sources":["node.ts"],"names":[],"mappings":"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","sourcesContent":["import { Handle } from '../../interfaces';\nimport Set from '../../../shim/Set';\nimport WeakMap from '../../../shim/WeakMap';\nimport * as http from 'http';\nimport * as https from 'https';\nimport * as urlUtil from 'url';\nimport * as zlib from 'zlib';\nimport Task from '../../async/Task';\nimport { deepAssign } from '../../lang';\nimport { queueTask } from '../../queue';\nimport { createTimer } from '../../util';\nimport Headers from '../Headers';\nimport { RequestOptions, UploadObservableTask } from '../interfaces';\nimport Response from '../Response';\nimport TimeoutError from '../TimeoutError';\nimport { Readable } from 'stream';\nimport Observable from '../../Observable';\nimport SubscriptionPool from '../SubscriptionPool';\n\n/**\n * Request options specific to a node request. For HTTPS options, see\n * https://nodejs.org/api/tls.html#tls_tls_connect_options_callback for more details.\n */\nexport interface NodeRequestOptions extends RequestOptions {\n\t/**\n\t * User-agent header\n\t */\n\tagent?: any;\n\t/**\n\t * If specified, the request body is read from the stream specified here, rather than from the `body` field.\n\t */\n\tbodyStream?: Readable;\n\t/**\n\t * HTTPS optionally override the trusted CA certificates\n\t */\n\tca?: any;\n\t/**\n\t * HTTPS optional cert chains in PEM format. One cert chain should be provided per private key.\n\t */\n\tcert?: string;\n\t/**\n\t * HTTPS optional cipher suite specification\n\t */\n\tciphers?: string;\n\tdataEncoding?: string;\n\t/**\n\t * Whether or not to automatically follow redirects (default true)\n\t */\n\tfollowRedirects?: boolean;\n\t/**\n\t * HTTPS optional private key in PEM format.\n\t */\n\tkey?: string;\n\t/**\n\t * Local interface to bind for network connections.\n\t */\n\tlocalAddress?: string;\n\t/**\n\t * HTTPS optional shared passphrase used for a single private key and/or a PFX.\n\t */\n\tpassphrase?: string;\n\t/**\n\t * HTTPS optional PFX or PKCS12 encoded private key and certificate chain.\n\t */\n\tpfx?: any;\n\t/**\n\t * Optional proxy address. If specified, requests will be sent through this url.\n\t */\n\tproxy?: string;\n\t/**\n\t * HTTPS If not false the server will reject any connection which is not authorized with the list of supplied CAs\n\t */\n\trejectUnauthorized?: boolean;\n\t/**\n\t * HTTPS optional SSL method to use, default is \"SSLv23_method\"\n\t */\n\tsecureProtocol?: string;\n\t/**\n\t * Unix Domain Socket (use one of host:port or socketPath)\n\t */\n\tsocketPath?: string;\n\t/**\n\t * Whether or not to add the gzip and deflate accept headers (default true)\n\t */\n\tacceptCompression?: boolean;\n\t/**\n\t * A set of options to set on the HTTP request\n\t */\n\tsocketOptions?: {\n\t\t/**\n\t\t * Enable/disable keep-alive functionality, and optionally set the initial delay before the first keepalive probe is sent on an idle socket.\n\t\t */\n\t\tkeepAlive?: number;\n\t\t/**\n\t\t * Disables the Nagle algorithm. By default TCP connections use the Nagle algorithm, they buffer data before sending it off.\n\t\t */\n\t\tnoDelay?: boolean;\n\t\t/**\n\t\t * Number of milliseconds before the HTTP request times out\n\t\t */\n\t\ttimeout?: number;\n\t};\n\t/**\n\t * Stream encoding on incoming HTTP response\n\t */\n\tstreamEncoding?: string;\n\t/**\n\t * Options to control redirect follow logic\n\t */\n\tredirectOptions?: {\n\t\t/**\n\t\t * The limit to the number of redirects that will be followed (default 15). This is used to prevent infinite\n\t\t * redirect loops.\n\t\t */\n\t\tlimit?: number;\n\t\tcount?: number;\n\t\t/**\n\t\t * Whether or not to keep the original HTTP method during 301 redirects (default false).\n\t\t */\n\t\tkeepOriginalMethod?: boolean;\n\t};\n}\n\n// TODO: This should be read from the package and not hard coded!\nlet version = '2.0.0-pre';\n\n/**\n * If not overridden, redirects will only be processed this many times before aborting (per request).\n * @type {number}\n */\nconst DEFAULT_REDIRECT_LIMIT = 15;\n\n/**\n * Options to be passed to node's request\n */\ninterface Options {\n\tagent?: any;\n\tauth?: string;\n\theaders?: { [name: string]: string };\n\thost?: string;\n\thostname?: string;\n\tlocalAddress?: string;\n\tmethod?: string;\n\tpath?: string;\n\tport?: number;\n\tsocketPath?: string;\n}\n\n/**\n * HTTPS specific options for node\n */\ninterface HttpsOptions extends Options {\n\tca?: any;\n\tcert?: string;\n\tciphers?: string;\n\tkey?: string;\n\tpassphrase?: string;\n\tpfx?: any;\n\trejectUnauthorized?: boolean;\n\tsecureProtocol?: string;\n}\n\ninterface RequestData {\n\ttask: Task<http.IncomingMessage>;\n\tbuffer: any[];\n\tdata: Buffer;\n\tsize: number;\n\tused: boolean;\n\tnativeResponse: http.IncomingMessage;\n\trequestOptions: NodeRequestOptions;\n\turl: string;\n\tdownloadObservable: Observable<number>;\n\tdataObservable: Observable<any>;\n}\n\nconst dataMap = new WeakMap<NodeResponse, RequestData>();\nconst discardedDuplicates = new Set<string>([\n\t'age',\n\t'authorization',\n\t'content-length',\n\t'content-type',\n\t'etag',\n\t'expires',\n\t'from',\n\t'host',\n\t'if-modified-since',\n\t'if-unmodified-since',\n\t'last-modified',\n\t'location',\n\t'max-forwards',\n\t'proxy-authorization',\n\t'referer',\n\t'retry-after',\n\t'user-agent'\n]);\n\nfunction getDataTask(response: NodeResponse): Task<RequestData> {\n\tconst data = dataMap.get(response)!;\n\n\tif (data.used) {\n\t\treturn Task.reject<any>(new TypeError('Body already read'));\n\t}\n\n\tdata.used = true;\n\n\treturn <Task<RequestData>>data.task.then((_) => data);\n}\n\n/**\n * Turn a node native response object into something that resembles the fetch api\n */\nexport class NodeResponse extends Response {\n\treadonly headers: Headers;\n\treadonly ok: boolean;\n\treadonly status: number;\n\treadonly statusText: string;\n\n\tdownloadBody = true;\n\n\tget bodyUsed(): boolean {\n\t\treturn dataMap.get(this)!.used;\n\t}\n\n\tget nativeResponse(): http.IncomingMessage {\n\t\treturn dataMap.get(this)!.nativeResponse;\n\t}\n\n\tget requestOptions(): NodeRequestOptions {\n\t\treturn dataMap.get(this)!.requestOptions;\n\t}\n\n\tget url(): string {\n\t\treturn dataMap.get(this)!.url;\n\t}\n\n\tget download(): Observable<number> {\n\t\treturn dataMap.get(this)!.downloadObservable;\n\t}\n\n\tget data(): Observable<any> {\n\t\treturn dataMap.get(this)!.dataObservable;\n\t}\n\n\tconstructor(response: http.IncomingMessage) {\n\t\tsuper();\n\n\t\tconst headers = (this.headers = new Headers());\n\t\tfor (let key in response.headers) {\n\t\t\tconst value = response.headers[key];\n\t\t\tif (value) {\n\t\t\t\tif (discardedDuplicates.has(key) && !Array.isArray(value)) {\n\t\t\t\t\theaders.append(key, value);\n\t\t\t\t}\n\t\t\t\t(Array.isArray(value) ? value : value.split(/\\s*,\\s*/)).forEach((v) => {\n\t\t\t\t\theaders.append(key, v);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.status = response.statusCode || 0;\n\t\tthis.ok = this.status >= 200 && this.status < 300;\n\t\tthis.statusText = response.statusMessage || '';\n\t}\n\n\tarrayBuffer(): Task<ArrayBuffer> {\n\t\treturn <any>getDataTask(this).then((data) => {\n\t\t\tif (data) {\n\t\t\t\treturn data.data;\n\t\t\t}\n\n\t\t\treturn new Buffer([]);\n\t\t});\n\t}\n\n\tblob(): Task<Blob> {\n\t\t// Node doesn't support Blobs\n\t\treturn Task.reject<Blob>(new Error('Blob not supported'));\n\t}\n\n\tformData(): Task<FormData> {\n\t\treturn Task.reject<FormData>(new Error('FormData not supported'));\n\t}\n\n\ttext(): Task<string> {\n\t\treturn <any>getDataTask(this).then((data) => {\n\t\t\treturn String(data ? data.data : '');\n\t\t});\n\t}\n}\n\nfunction redirect(\n\tresolve: (p?: any) => void,\n\treject: (_?: Error) => void,\n\toriginalUrl: string,\n\tredirectUrl: string | null,\n\toptions: NodeRequestOptions\n): boolean {\n\tif (!options.redirectOptions) {\n\t\toptions.redirectOptions = {};\n\t}\n\n\tconst { limit: redirectLimit = DEFAULT_REDIRECT_LIMIT, count: redirectCount = 0 } = options.redirectOptions;\n\tconst { followRedirects = true } = options;\n\n\tif (!followRedirects) {\n\t\treturn false;\n\t}\n\n\t// we only check for undefined here because empty string redirects are now allowed\n\t// (they'll resolve to the current url)\n\tif (redirectUrl === undefined || redirectUrl === null) {\n\t\treject(new Error('asked to redirect but no location header was found'));\n\t\treturn true;\n\t}\n\n\tif (redirectCount > redirectLimit) {\n\t\treject(new Error(`too many redirects, limit reached at ${redirectLimit}`));\n\t\treturn true;\n\t}\n\n\toptions.redirectOptions.count = redirectCount + 1;\n\n\t// we wrap the url in a call to node's URL.resolve which will handle relative and partial\n\t// redirects (like \"/another-page\" on the same domain).\n\tresolve(node(urlUtil.resolve(originalUrl, redirectUrl), options));\n\n\treturn true;\n}\n\nexport function getAuth(proxyAuth: string | undefined, options: NodeRequestOptions): string | undefined {\n\tif (proxyAuth) {\n\t\treturn proxyAuth;\n\t}\n\n\tif (options.user || options.password) {\n\t\treturn `${options.user || ''}:${options.password || ''}`;\n\t}\n\n\treturn undefined;\n}\n\nexport default function node(url: string, options: NodeRequestOptions = {}): UploadObservableTask<NodeResponse> {\n\tconst parsedUrl = urlUtil.parse(options.proxy || url);\n\n\tconst requestOptions: HttpsOptions = {\n\t\tagent: options.agent,\n\t\tauth: getAuth(parsedUrl.auth, options),\n\t\tca: options.ca,\n\t\tcert: options.cert,\n\t\tciphers: options.ciphers,\n\t\thost: parsedUrl.host,\n\t\thostname: parsedUrl.hostname,\n\t\tkey: options.key,\n\t\tlocalAddress: options.localAddress,\n\t\tmethod: options.method ? options.method.toUpperCase() : 'GET',\n\t\tpassphrase: options.passphrase,\n\t\tpath: parsedUrl.path,\n\t\tpfx: options.pfx,\n\t\tport: Number(parsedUrl.port),\n\t\trejectUnauthorized: options.rejectUnauthorized,\n\t\tsecureProtocol: options.secureProtocol,\n\t\tsocketPath: options.socketPath\n\t};\n\n\trequestOptions.headers = <{ [key: string]: string }>options.headers || {};\n\n\tif (\n\t\t!Object.keys(requestOptions.headers)\n\t\t\t.map((headerName) => headerName.toLowerCase())\n\t\t\t.some((headerName) => headerName === 'user-agent')\n\t) {\n\t\trequestOptions.headers['user-agent'] = 'dojo/' + version + ' Node.js/' + process.version.replace(/^v/, '');\n\t}\n\n\tif (options.proxy) {\n\t\trequestOptions.path = url;\n\t\tif (parsedUrl.auth) {\n\t\t\trequestOptions.headers['proxy-authorization'] = 'Basic ' + new Buffer(parsedUrl.auth).toString('base64');\n\t\t}\n\n\t\tconst parsedProxyUrl = urlUtil.parse(url);\n\t\tif (parsedProxyUrl.host) {\n\t\t\trequestOptions.headers['host'] = parsedProxyUrl.host;\n\t\t}\n\n\t\tif (parsedProxyUrl.auth) {\n\t\t\trequestOptions.auth = parsedProxyUrl.auth;\n\t\t}\n\t}\n\n\tconst { acceptCompression = true } = options;\n\tif (acceptCompression) {\n\t\trequestOptions.headers['Accept-Encoding'] = 'gzip, deflate';\n\t}\n\n\tconst request = parsedUrl.protocol === 'https:' ? https.request(requestOptions) : http.request(requestOptions);\n\n\tconst uploadObserverPool = new SubscriptionPool<number>();\n\n\tconst requestTask = <UploadObservableTask<NodeResponse>>new Task<NodeResponse>(\n\t\t(resolve, reject) => {\n\t\t\tlet timeoutHandle: Handle;\n\t\t\tlet timeoutReject: Function = reject;\n\n\t\t\tif (options.socketOptions) {\n\t\t\t\tif (options.socketOptions.timeout) {\n\t\t\t\t\trequest.setTimeout(options.socketOptions.timeout);\n\t\t\t\t}\n\n\t\t\t\tif ('noDelay' in options.socketOptions) {\n\t\t\t\t\trequest.setNoDelay(options.socketOptions.noDelay);\n\t\t\t\t}\n\n\t\t\t\tif ('keepAlive' in options.socketOptions) {\n\t\t\t\t\tconst initialDelay: number | undefined = options.socketOptions.keepAlive;\n\t\t\t\t\tif (initialDelay !== undefined) {\n\t\t\t\t\t\trequest.setSocketKeepAlive(initialDelay >= 0, initialDelay);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trequest.once('response', (message: http.IncomingMessage) => {\n\t\t\t\tconst response = new NodeResponse(message);\n\n\t\t\t\t// Redirection handling defaults to true in order to harmonise with the XHR provider, which will always\n\t\t\t\t// follow redirects\n\t\t\t\tif (response.status >= 300 && response.status < 400) {\n\t\t\t\t\tconst redirectOptions = options.redirectOptions || {};\n\t\t\t\t\tconst newOptions = deepAssign({}, options);\n\n\t\t\t\t\tswitch (response.status) {\n\t\t\t\t\t\tcase 300:\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * Note about 300 redirects. RFC 2616 doesn't specify what to do with them, it is up to the client to \"pick\n\t\t\t\t\t\t\t * the right one\".  We're picking like Chrome does, just don't pick any.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 301:\n\t\t\t\t\t\tcase 302:\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * RFC 2616 says,\n\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t *     If the 301 status code is received in response to a request other\n\t\t\t\t\t\t\t *     than GET or HEAD, the user agent MUST NOT automatically redirect the\n\t\t\t\t\t\t\t *     request unless it can be confirmed by the user, since this might\n\t\t\t\t\t\t\t *       change the conditions under which the request was issued.\n\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t *     Note: When automatically redirecting a POST request after\n\t\t\t\t\t\t\t *     receiving a 301 status code, some existing HTTP/1.0 user agents\n\t\t\t\t\t\t\t *     will erroneously change it into a GET request.\n\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t * We're going to be one of those erroneous agents, to prevent the request from failing..\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\trequestOptions.method !== 'GET' &&\n\t\t\t\t\t\t\t\trequestOptions.method !== 'HEAD' &&\n\t\t\t\t\t\t\t\t!redirectOptions.keepOriginalMethod\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tnewOptions.method = 'GET';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (redirect(resolve, reject, url, response.headers.get('location'), newOptions)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 303:\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * The response to the request can be found under a different URI and\n\t\t\t\t\t\t\t * SHOULD be retrieved using a GET method on that resource.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tif (requestOptions.method !== 'GET') {\n\t\t\t\t\t\t\t\tnewOptions.method = 'GET';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (redirect(resolve, reject, url, response.headers.get('location'), newOptions)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 304:\n\t\t\t\t\t\t\t// do nothing so this can fall through and return the response as normal. Nothing more can\n\t\t\t\t\t\t\t// be done for 304\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 305:\n\t\t\t\t\t\t\tif (!response.headers.get('location')) {\n\t\t\t\t\t\t\t\treject(new Error('expected Location header to contain a proxy url'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewOptions.proxy = response.headers.get('location') || '';\n\t\t\t\t\t\t\t\tif (redirect(resolve, reject, url, '', newOptions)) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 307:\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t *  If the 307 status code is received in response to a request other\n\t\t\t\t\t\t\t *  than GET or HEAD, the user agent MUST NOT automatically redirect the\n\t\t\t\t\t\t\t *  request unless it can be confirmed by the user, since this might\n\t\t\t\t\t\t\t *  change the conditions under which the request was issued.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tif (redirect(resolve, reject, url, response.headers.get('location'), newOptions)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treject(new Error('unhandled redirect status ' + response.status));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toptions.streamEncoding && message.setEncoding(options.streamEncoding);\n\n\t\t\t\tconst downloadSubscriptionPool = new SubscriptionPool<number>();\n\t\t\t\tconst dataSubscriptionPool = new SubscriptionPool<any>();\n\n\t\t\t\t/*\n\t\t\t [RFC 2616](https://tools.ietf.org/html/rfc2616#page-118) says that content-encoding can have multiple\n\t\t\t values, so we split them here and put them in a list to process later.\n\t\t\t */\n\t\t\t\tconst contentEncodings = response.headers.getAll('content-encoding');\n\n\t\t\t\tconst task = new Task<http.IncomingMessage>(\n\t\t\t\t\t(resolve, reject) => {\n\t\t\t\t\t\ttimeoutReject = reject;\n\n\t\t\t\t\t\t// we queue this up for later to allow listeners to register themselves before we start receiving data\n\t\t\t\t\t\tqueueTask(() => {\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t * Note that this is the raw data, if your input stream is zipped, and you are piecing\n\t\t\t\t\t * together the downloaded data, you'll have to decompress it yourself\n\t\t\t\t\t */\n\t\t\t\t\t\t\tmessage.on('data', (chunk: any) => {\n\t\t\t\t\t\t\t\tdataSubscriptionPool.next(chunk);\n\n\t\t\t\t\t\t\t\tif (response.downloadBody) {\n\t\t\t\t\t\t\t\t\tdata.buffer.push(chunk);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdata.size +=\n\t\t\t\t\t\t\t\t\ttypeof chunk === 'string'\n\t\t\t\t\t\t\t\t\t\t? Buffer.byteLength(chunk, options.streamEncoding)\n\t\t\t\t\t\t\t\t\t\t: chunk.length;\n\n\t\t\t\t\t\t\t\tdownloadSubscriptionPool.next(data.size);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tmessage.once('end', () => {\n\t\t\t\t\t\t\t\ttimeoutHandle && timeoutHandle.destroy();\n\n\t\t\t\t\t\t\t\tlet dataAsBuffer = options.streamEncoding\n\t\t\t\t\t\t\t\t\t? new Buffer(data.buffer.join(''), 'utf8')\n\t\t\t\t\t\t\t\t\t: Buffer.concat(data.buffer, data.size);\n\n\t\t\t\t\t\t\t\tconst handleEncoding = function() {\n\t\t\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t Content encoding is ordered by the order in which they were applied to the\n\t\t\t\t\t\t\t content, so do undo the encoding we have to start at the end and work backwards.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\tif (contentEncodings.length) {\n\t\t\t\t\t\t\t\t\t\tconst encoding = contentEncodings.pop()!.trim().toLowerCase();\n\n\t\t\t\t\t\t\t\t\t\tif (encoding === '' || encoding === 'none' || encoding === 'identity') {\n\t\t\t\t\t\t\t\t\t\t\t// do nothing, response stream is as-is\n\t\t\t\t\t\t\t\t\t\t\thandleEncoding();\n\t\t\t\t\t\t\t\t\t\t} else if (encoding === 'gzip') {\n\t\t\t\t\t\t\t\t\t\t\tzlib.gunzip(dataAsBuffer, function(err: Error | null, result: Buffer) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tdataAsBuffer = result;\n\t\t\t\t\t\t\t\t\t\t\t\thandleEncoding();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else if (encoding === 'deflate') {\n\t\t\t\t\t\t\t\t\t\t\tzlib.inflate(dataAsBuffer, function(err: Error | null, result: Buffer) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tdataAsBuffer = result;\n\t\t\t\t\t\t\t\t\t\t\t\thandleEncoding();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\treject(new Error('Unsupported content encoding, ' + encoding));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdata.data = dataAsBuffer;\n\n\t\t\t\t\t\t\t\t\t\tresolve(message);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\thandleEncoding();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t() => {\n\t\t\t\t\t\trequest.abort();\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tconst data: RequestData = {\n\t\t\t\t\ttask,\n\t\t\t\t\tbuffer: [],\n\t\t\t\t\tdata: Buffer.alloc(0),\n\t\t\t\t\tsize: 0,\n\t\t\t\t\tused: false,\n\t\t\t\t\turl: url,\n\t\t\t\t\trequestOptions: options,\n\t\t\t\t\tnativeResponse: message,\n\t\t\t\t\tdownloadObservable: new Observable<number>((observer) => downloadSubscriptionPool.add(observer)),\n\t\t\t\t\tdataObservable: new Observable<any>((observer) => dataSubscriptionPool.add(observer))\n\t\t\t\t};\n\n\t\t\t\tdataMap.set(response, data);\n\n\t\t\t\tresolve(response);\n\t\t\t});\n\n\t\t\trequest.once('error', reject);\n\n\t\t\tif (options.bodyStream) {\n\t\t\t\toptions.bodyStream.pipe(request);\n\t\t\t\tlet uploadedSize = 0;\n\n\t\t\t\toptions.bodyStream.on('data', (chunk: any) => {\n\t\t\t\t\tuploadedSize += chunk.length;\n\t\t\t\t\tuploadObserverPool.next(uploadedSize);\n\t\t\t\t});\n\n\t\t\t\toptions.bodyStream.on('end', () => {\n\t\t\t\t\tuploadObserverPool.complete();\n\t\t\t\t\trequest.end();\n\t\t\t\t});\n\t\t\t} else if (options.body) {\n\t\t\t\tconst body = options.body.toString();\n\n\t\t\t\trequest.on('response', () => {\n\t\t\t\t\tuploadObserverPool.next(body.length);\n\t\t\t\t});\n\n\t\t\t\trequest.end(body);\n\t\t\t} else {\n\t\t\t\trequest.end();\n\t\t\t}\n\n\t\t\tif (options.timeout && options.timeout > 0 && options.timeout !== Infinity) {\n\t\t\t\ttimeoutHandle = createTimer(() => {\n\t\t\t\t\ttimeoutReject && timeoutReject(new TimeoutError('The request timed out'));\n\t\t\t\t}, options.timeout);\n\t\t\t}\n\t\t},\n\t\t() => {\n\t\t\trequest.abort();\n\t\t}\n\t).catch(function(error: Error): any {\n\t\tconst parsedUrl = urlUtil.parse(url);\n\n\t\tif (parsedUrl.auth) {\n\t\t\tparsedUrl.auth = '(redacted)';\n\t\t}\n\n\t\tconst sanitizedUrl = urlUtil.format(parsedUrl);\n\n\t\terror.message = '[' + requestOptions.method + ' ' + sanitizedUrl + '] ' + error.message;\n\t\tthrow error;\n\t});\n\n\trequestTask.upload = new Observable<number>((observer) => uploadObserverPool.add(observer));\n\n\treturn requestTask;\n}\n"]}