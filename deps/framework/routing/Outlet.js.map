{"version":3,"file":"Outlet.js","sourceRoot":"","sources":["Outlet.ts"],"names":[],"mappings":"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","sourcesContent":["import { DNode, WidgetBaseInterface } from '../widget-core/interfaces';\nimport { WidgetBase } from '../widget-core/WidgetBase';\nimport { w } from '../widget-core/d';\nimport { inject } from '../widget-core/decorators/inject';\nimport { alwaysRender } from '../widget-core/decorators/alwaysRender';\nimport { OnEnter, Component, OutletOptions, OutletComponents, Outlet, Params, OutletContext } from './interfaces';\nimport { Router } from './Router';\n\nexport function isComponent<W extends WidgetBaseInterface>(value: any): value is Component<W> {\n\treturn Boolean(value && (typeof value === 'string' || typeof value === 'function' || typeof value === 'symbol'));\n}\n\nexport function getProperties(router: Router, properties: any) {\n\treturn { router };\n}\n\nexport function Outlet<W extends WidgetBaseInterface, F extends WidgetBaseInterface, E extends WidgetBaseInterface>(\n\toutletComponents: Component<W> | OutletComponents<W, F, E>,\n\toutlet: string,\n\toptions: OutletOptions = {}\n): Outlet<W, F, E> {\n\tconst indexComponent = isComponent(outletComponents) ? undefined : outletComponents.index;\n\tconst mainComponent = isComponent(outletComponents) ? outletComponents : outletComponents.main;\n\tconst errorComponent = isComponent(outletComponents) ? undefined : outletComponents.error;\n\tconst { mapParams, key = 'router' } = options;\n\n\t@inject({ name: key, getProperties })\n\t@alwaysRender()\n\tclass OutletComponent extends WidgetBase<Partial<W['properties']> & { router: Router }, null> {\n\t\tprivate _matched = false;\n\t\tprivate _matchedParams: Params = {};\n\t\tprivate _onExit?: () => void;\n\n\t\tprivate _hasRouteChanged(params: Params): boolean {\n\t\t\tif (!this._matched) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst newParamKeys = Object.keys(params);\n\t\t\tfor (let i = 0; i < newParamKeys.length; i++) {\n\t\t\t\tconst key = newParamKeys[i];\n\t\t\t\tif (this._matchedParams[key] !== params[key]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate _onEnter(outletContext: OutletContext, onEnterCallback?: OnEnter) {\n\t\t\tconst { params, type } = outletContext;\n\t\t\tif (this._hasRouteChanged(params)) {\n\t\t\t\tonEnterCallback && onEnterCallback(params, type);\n\t\t\t\tthis._matched = true;\n\t\t\t\tthis._matchedParams = params;\n\t\t\t}\n\t\t}\n\n\t\tprotected onDetach() {\n\t\t\tif (this._matched) {\n\t\t\t\tthis._onExit && this._onExit();\n\t\t\t\tthis._matched = false;\n\t\t\t}\n\t\t}\n\n\t\tprotected render(): DNode {\n\t\t\tlet { router, ...properties } = this.properties;\n\n\t\t\tconst outletContext = router.getOutlet(outlet);\n\t\t\tif (outletContext) {\n\t\t\t\tconst { queryParams, params, type, onEnter, onExit } = outletContext;\n\t\t\t\tthis._onExit = onExit;\n\t\t\t\tif (mapParams) {\n\t\t\t\t\tproperties = { ...properties, ...mapParams({ queryParams, params, type, router }) };\n\t\t\t\t}\n\n\t\t\t\tif (type === 'index' && indexComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(indexComponent, properties, this.children);\n\t\t\t\t} else if (type === 'error' && errorComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(errorComponent, properties, this.children);\n\t\t\t\t} else if (type === 'error' && indexComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(indexComponent, properties, this.children);\n\t\t\t\t} else if (type !== 'error' && mainComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(mainComponent, properties, this.children);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._matched) {\n\t\t\t\tthis._onExit && this._onExit();\n\t\t\t\tthis._matched = false;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn OutletComponent;\n}\n\nexport default Outlet;\n"]}