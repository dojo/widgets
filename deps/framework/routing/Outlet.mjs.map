{"version":3,"file":"Outlet.mjs","sourceRoot":"","sources":["../../../../src/routing/Outlet.ts"],"names":[],"mappings":"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","sourcesContent":["import { DNode, WidgetBaseInterface } from '../widget-core/interfaces';\nimport { WidgetBase } from '../widget-core/WidgetBase';\nimport { w } from '../widget-core/d';\nimport { inject } from '../widget-core/decorators/inject';\nimport { alwaysRender } from '../widget-core/decorators/alwaysRender';\nimport { OnEnter, Component, OutletOptions, OutletComponents, Outlet, Params, OutletContext } from './interfaces';\nimport { Router } from './Router';\n\nexport function isComponent<W extends WidgetBaseInterface>(value: any): value is Component<W> {\n\treturn Boolean(value && (typeof value === 'string' || typeof value === 'function' || typeof value === 'symbol'));\n}\n\nexport function getProperties(router: Router, properties: any) {\n\treturn { router };\n}\n\nexport function Outlet<W extends WidgetBaseInterface, F extends WidgetBaseInterface, E extends WidgetBaseInterface>(\n\toutletComponents: Component<W> | OutletComponents<W, F, E>,\n\toutlet: string,\n\toptions: OutletOptions = {}\n): Outlet<W, F, E> {\n\tconst indexComponent = isComponent(outletComponents) ? undefined : outletComponents.index;\n\tconst mainComponent = isComponent(outletComponents) ? outletComponents : outletComponents.main;\n\tconst errorComponent = isComponent(outletComponents) ? undefined : outletComponents.error;\n\tconst { mapParams, key = 'router' } = options;\n\n\t@inject({ name: key, getProperties })\n\t@alwaysRender()\n\tclass OutletComponent extends WidgetBase<Partial<W['properties']> & { router: Router }, null> {\n\t\tprivate _matched = false;\n\t\tprivate _matchedParams: Params = {};\n\t\tprivate _onExit?: () => void;\n\n\t\tprivate _hasRouteChanged(params: Params): boolean {\n\t\t\tif (!this._matched) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst newParamKeys = Object.keys(params);\n\t\t\tfor (let i = 0; i < newParamKeys.length; i++) {\n\t\t\t\tconst key = newParamKeys[i];\n\t\t\t\tif (this._matchedParams[key] !== params[key]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate _onEnter(outletContext: OutletContext, onEnterCallback?: OnEnter) {\n\t\t\tconst { params, type } = outletContext;\n\t\t\tif (this._hasRouteChanged(params)) {\n\t\t\t\tonEnterCallback && onEnterCallback(params, type);\n\t\t\t\tthis._matched = true;\n\t\t\t\tthis._matchedParams = params;\n\t\t\t}\n\t\t}\n\n\t\tprotected onDetach() {\n\t\t\tif (this._matched) {\n\t\t\t\tthis._onExit && this._onExit();\n\t\t\t\tthis._matched = false;\n\t\t\t}\n\t\t}\n\n\t\tprotected render(): DNode {\n\t\t\tlet { router, ...properties } = this.properties;\n\n\t\t\tconst outletContext = router.getOutlet(outlet);\n\t\t\tif (outletContext) {\n\t\t\t\tconst { queryParams, params, type, onEnter, onExit } = outletContext;\n\t\t\t\tthis._onExit = onExit;\n\t\t\t\tif (mapParams) {\n\t\t\t\t\tproperties = { ...properties, ...mapParams({ queryParams, params, type, router }) };\n\t\t\t\t}\n\n\t\t\t\tif (type === 'index' && indexComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(indexComponent, properties, this.children);\n\t\t\t\t} else if (type === 'error' && errorComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(errorComponent, properties, this.children);\n\t\t\t\t} else if (type === 'error' && indexComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(indexComponent, properties, this.children);\n\t\t\t\t} else if (type !== 'error' && mainComponent) {\n\t\t\t\t\tthis._onEnter(outletContext, onEnter);\n\t\t\t\t\treturn w(mainComponent, properties, this.children);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._matched) {\n\t\t\t\tthis._onExit && this._onExit();\n\t\t\t\tthis._matched = false;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn OutletComponent;\n}\n\nexport default Outlet;\n"]}