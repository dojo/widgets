{"version":3,"file":"registerCustomElement.js","sourceRoot":"","sources":["../../../../src/widget-core/registerCustomElement.ts"],"names":[],"mappings":"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","sourcesContent":["import { WidgetBase, noBind } from './WidgetBase';\nimport { ProjectorMixin } from './mixins/Projector';\nimport { from } from '../shim/array';\nimport { w, dom } from './d';\nimport global from '../shim/global';\nimport { registerThemeInjector } from './mixins/Themed';\nimport { alwaysRender } from './decorators/alwaysRender';\n\nexport enum CustomElementChildType {\n\tDOJO = 'DOJO',\n\tNODE = 'NODE',\n\tTEXT = 'TEXT'\n}\n\nexport function DomToWidgetWrapper(domNode: HTMLElement): any {\n\t@alwaysRender()\n\tclass DomToWidgetWrapper extends WidgetBase<any> {\n\t\tprotected render() {\n\t\t\tconst properties = Object.keys(this.properties).reduce(\n\t\t\t\t(props, key: string) => {\n\t\t\t\t\tconst value = this.properties[key];\n\t\t\t\t\tif (key.indexOf('on') === 0) {\n\t\t\t\t\t\tkey = `__${key}`;\n\t\t\t\t\t}\n\t\t\t\t\tprops[key] = value;\n\t\t\t\t\treturn props;\n\t\t\t\t},\n\t\t\t\t{} as any\n\t\t\t);\n\t\t\treturn dom({ node: domNode, props: properties, diffType: 'dom' });\n\t\t}\n\n\t\tstatic get domNode() {\n\t\t\treturn domNode;\n\t\t}\n\t}\n\n\treturn DomToWidgetWrapper;\n}\n\nexport function create(descriptor: any, WidgetConstructor: any): any {\n\tconst { attributes, childType, registryFactory } = descriptor;\n\tconst attributeMap: any = {};\n\n\tattributes.forEach((propertyName: string) => {\n\t\tconst attributeName = propertyName.toLowerCase();\n\t\tattributeMap[attributeName] = propertyName;\n\t});\n\n\treturn class extends HTMLElement {\n\t\tprivate _projector: any;\n\t\tprivate _properties: any = {};\n\t\tprivate _children: any[] = [];\n\t\tprivate _eventProperties: any = {};\n\t\tprivate _initialised = false;\n\n\t\tpublic connectedCallback() {\n\t\t\tif (this._initialised) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst domProperties: any = {};\n\t\t\tconst { attributes, properties, events } = descriptor;\n\n\t\t\tthis._properties = { ...this._properties, ...this._attributesToProperties(attributes) };\n\n\t\t\t[...attributes, ...properties].forEach((propertyName: string) => {\n\t\t\t\tconst value = (this as any)[propertyName];\n\t\t\t\tconst filteredPropertyName = propertyName.replace(/^on/, '__');\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis._properties[propertyName] = value;\n\t\t\t\t}\n\n\t\t\t\tif (filteredPropertyName !== propertyName) {\n\t\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tdomProperties[propertyName] = {\n\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tevents.forEach((propertyName: string) => {\n\t\t\t\tconst eventName = propertyName.replace(/^on/, '').toLowerCase();\n\t\t\t\tconst filteredPropertyName = propertyName.replace(/^on/, '__on');\n\n\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\tget: () => this._getEventProperty(propertyName),\n\t\t\t\t\tset: (value: any) => this._setEventProperty(propertyName, value)\n\t\t\t\t};\n\n\t\t\t\tthis._eventProperties[propertyName] = undefined;\n\t\t\t\tthis._properties[propertyName] = (...args: any[]) => {\n\t\t\t\t\tconst eventCallback = this._getEventProperty(propertyName);\n\t\t\t\t\tif (typeof eventCallback === 'function') {\n\t\t\t\t\t\teventCallback(...args);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent(eventName, {\n\t\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\t\tdetail: args\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tObject.defineProperties(this, domProperties);\n\n\t\t\tconst children = childType === CustomElementChildType.TEXT ? this.childNodes : this.children;\n\n\t\t\tfrom(children).forEach((childNode: Node) => {\n\t\t\t\tif (childType === CustomElementChildType.DOJO) {\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-connected', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(childNode as HTMLElement));\n\t\t\t\t} else {\n\t\t\t\t\tthis._children.push(dom({ node: childNode as HTMLElement, diffType: 'dom' }));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addEventListener('dojo-ce-connected', (e: any) => this._childConnected(e));\n\n\t\t\tconst widgetProperties = this._properties;\n\t\t\tconst renderChildren = () => this.__children__();\n\t\t\tconst Wrapper = class extends WidgetBase {\n\t\t\t\trender() {\n\t\t\t\t\treturn w(WidgetConstructor, widgetProperties, renderChildren());\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst registry = registryFactory();\n\t\t\tconst themeContext = registerThemeInjector(this._getTheme(), registry);\n\t\t\tglobal.addEventListener('dojo-theme-set', () => themeContext.set(this._getTheme()));\n\t\t\tconst Projector = ProjectorMixin(Wrapper);\n\t\t\tthis._projector = new Projector();\n\t\t\tthis._projector.setProperties({ registry });\n\t\t\tthis._projector.append(this);\n\n\t\t\tthis._initialised = true;\n\t\t\tthis.dispatchEvent(\n\t\t\t\tnew CustomEvent('dojo-ce-connected', {\n\t\t\t\t\tbubbles: true,\n\t\t\t\t\tdetail: this\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tprivate _getTheme() {\n\t\t\tif (global && global.dojoce && global.dojoce.theme) {\n\t\t\t\treturn global.dojoce.themes[global.dojoce.theme];\n\t\t\t}\n\t\t}\n\n\t\tprivate _childConnected(e: any) {\n\t\t\tconst node = e.detail;\n\t\t\tif (node.parentNode === this) {\n\t\t\t\tconst exists = this._children.some((child) => child.domNode === node);\n\t\t\t\tif (!exists) {\n\t\t\t\t\tnode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(node));\n\t\t\t\t\tthis._render();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _render() {\n\t\t\tif (this._projector) {\n\t\t\t\tthis._projector.invalidate();\n\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('dojo-ce-render', {\n\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\tdetail: this\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic __properties__() {\n\t\t\treturn { ...this._properties, ...this._eventProperties };\n\t\t}\n\n\t\tpublic __children__() {\n\t\t\tif (childType === CustomElementChildType.DOJO) {\n\t\t\t\treturn this._children.filter((Child) => Child.domNode.isWidget).map((Child: any) => {\n\t\t\t\t\tconst { domNode } = Child;\n\t\t\t\t\treturn w(Child, { ...domNode.__properties__() }, [...domNode.__children__()]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this._children;\n\t\t\t}\n\t\t}\n\n\t\tpublic attributeChangedCallback(name: string, oldValue: string | null, value: string | null) {\n\t\t\tconst propertyName = attributeMap[name];\n\t\t\tthis._setProperty(propertyName, value);\n\t\t}\n\n\t\tprivate _setEventProperty(propertyName: string, value: any) {\n\t\t\tthis._eventProperties[propertyName] = value;\n\t\t}\n\n\t\tprivate _getEventProperty(propertyName: string) {\n\t\t\treturn this._eventProperties[propertyName];\n\t\t}\n\n\t\tprivate _setProperty(propertyName: string, value: any) {\n\t\t\tif (typeof value === 'function') {\n\t\t\t\tvalue[noBind] = true;\n\t\t\t}\n\t\t\tthis._properties[propertyName] = value;\n\t\t\tthis._render();\n\t\t}\n\n\t\tprivate _getProperty(propertyName: string) {\n\t\t\treturn this._properties[propertyName];\n\t\t}\n\n\t\tprivate _attributesToProperties(attributes: string[]) {\n\t\t\treturn attributes.reduce((properties: any, propertyName: string) => {\n\t\t\t\tconst attributeName = propertyName.toLowerCase();\n\t\t\t\tconst value = this.getAttribute(attributeName);\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tproperties[propertyName] = value;\n\t\t\t\t}\n\t\t\t\treturn properties;\n\t\t\t}, {});\n\t\t}\n\n\t\tstatic get observedAttributes() {\n\t\t\treturn Object.keys(attributeMap);\n\t\t}\n\n\t\tpublic get isWidget() {\n\t\t\treturn true;\n\t\t}\n\t};\n}\n\nexport function register(WidgetConstructor: any): void {\n\tconst descriptor = WidgetConstructor.prototype && WidgetConstructor.prototype.__customElementDescriptor;\n\n\tif (!descriptor) {\n\t\tthrow new Error(\n\t\t\t'Cannot get descriptor for Custom Element, have you added the @customElement decorator to your Widget?'\n\t\t);\n\t}\n\n\tglobal.customElements.define(descriptor.tagName, create(descriptor, WidgetConstructor));\n}\n\nexport default register;\n"]}