{"version":3,"file":"registerCustomElement.mjs","sourceRoot":"","sources":["../../../../src/widget-core/registerCustomElement.ts"],"names":[],"mappings":"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","sourcesContent":["import { WidgetBase, noBind } from './WidgetBase';\nimport { ProjectorMixin } from './mixins/Projector';\nimport { from } from '../shim/array';\nimport { w, dom } from './d';\nimport global from '../shim/global';\nimport { registerThemeInjector } from './mixins/Themed';\nimport { alwaysRender } from './decorators/alwaysRender';\n\nexport enum CustomElementChildType {\n\tDOJO = 'DOJO',\n\tNODE = 'NODE',\n\tTEXT = 'TEXT'\n}\n\nexport function DomToWidgetWrapper(domNode: HTMLElement): any {\n\t@alwaysRender()\n\tclass DomToWidgetWrapper extends WidgetBase<any> {\n\t\tprotected render() {\n\t\t\tconst properties = Object.keys(this.properties).reduce(\n\t\t\t\t(props, key: string) => {\n\t\t\t\t\tconst value = this.properties[key];\n\t\t\t\t\tif (key.indexOf('on') === 0) {\n\t\t\t\t\t\tkey = `__${key}`;\n\t\t\t\t\t}\n\t\t\t\t\tprops[key] = value;\n\t\t\t\t\treturn props;\n\t\t\t\t},\n\t\t\t\t{} as any\n\t\t\t);\n\t\t\treturn dom({ node: domNode, props: properties, diffType: 'dom' });\n\t\t}\n\n\t\tstatic get domNode() {\n\t\t\treturn domNode;\n\t\t}\n\t}\n\n\treturn DomToWidgetWrapper;\n}\n\nexport function create(descriptor: any, WidgetConstructor: any): any {\n\tconst { attributes, childType, registryFactory } = descriptor;\n\tconst attributeMap: any = {};\n\n\tattributes.forEach((propertyName: string) => {\n\t\tconst attributeName = propertyName.toLowerCase();\n\t\tattributeMap[attributeName] = propertyName;\n\t});\n\n\treturn class extends HTMLElement {\n\t\tprivate _projector: any;\n\t\tprivate _properties: any = {};\n\t\tprivate _children: any[] = [];\n\t\tprivate _eventProperties: any = {};\n\t\tprivate _initialised = false;\n\n\t\tpublic connectedCallback() {\n\t\t\tif (this._initialised) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst domProperties: any = {};\n\t\t\tconst { attributes, properties, events } = descriptor;\n\n\t\t\tthis._properties = { ...this._properties, ...this._attributesToProperties(attributes) };\n\n\t\t\t[...attributes, ...properties].forEach((propertyName: string) => {\n\t\t\t\tconst value = (this as any)[propertyName];\n\t\t\t\tconst filteredPropertyName = propertyName.replace(/^on/, '__');\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis._properties[propertyName] = value;\n\t\t\t\t}\n\n\t\t\t\tif (filteredPropertyName !== propertyName) {\n\t\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tdomProperties[propertyName] = {\n\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tevents.forEach((propertyName: string) => {\n\t\t\t\tconst eventName = propertyName.replace(/^on/, '').toLowerCase();\n\t\t\t\tconst filteredPropertyName = propertyName.replace(/^on/, '__on');\n\n\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\tget: () => this._getEventProperty(propertyName),\n\t\t\t\t\tset: (value: any) => this._setEventProperty(propertyName, value)\n\t\t\t\t};\n\n\t\t\t\tthis._eventProperties[propertyName] = undefined;\n\t\t\t\tthis._properties[propertyName] = (...args: any[]) => {\n\t\t\t\t\tconst eventCallback = this._getEventProperty(propertyName);\n\t\t\t\t\tif (typeof eventCallback === 'function') {\n\t\t\t\t\t\teventCallback(...args);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent(eventName, {\n\t\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\t\tdetail: args\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tObject.defineProperties(this, domProperties);\n\n\t\t\tconst children = childType === CustomElementChildType.TEXT ? this.childNodes : this.children;\n\n\t\t\tfrom(children).forEach((childNode: Node) => {\n\t\t\t\tif (childType === CustomElementChildType.DOJO) {\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-connected', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(childNode as HTMLElement));\n\t\t\t\t} else {\n\t\t\t\t\tthis._children.push(dom({ node: childNode as HTMLElement, diffType: 'dom' }));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addEventListener('dojo-ce-connected', (e: any) => this._childConnected(e));\n\n\t\t\tconst widgetProperties = this._properties;\n\t\t\tconst renderChildren = () => this.__children__();\n\t\t\tconst Wrapper = class extends WidgetBase {\n\t\t\t\trender() {\n\t\t\t\t\treturn w(WidgetConstructor, widgetProperties, renderChildren());\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst registry = registryFactory();\n\t\t\tconst themeContext = registerThemeInjector(this._getTheme(), registry);\n\t\t\tglobal.addEventListener('dojo-theme-set', () => themeContext.set(this._getTheme()));\n\t\t\tconst Projector = ProjectorMixin(Wrapper);\n\t\t\tthis._projector = new Projector();\n\t\t\tthis._projector.setProperties({ registry });\n\t\t\tthis._projector.append(this);\n\n\t\t\tthis._initialised = true;\n\t\t\tthis.dispatchEvent(\n\t\t\t\tnew CustomEvent('dojo-ce-connected', {\n\t\t\t\t\tbubbles: true,\n\t\t\t\t\tdetail: this\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tprivate _getTheme() {\n\t\t\tif (global && global.dojoce && global.dojoce.theme) {\n\t\t\t\treturn global.dojoce.themes[global.dojoce.theme];\n\t\t\t}\n\t\t}\n\n\t\tprivate _childConnected(e: any) {\n\t\t\tconst node = e.detail;\n\t\t\tif (node.parentNode === this) {\n\t\t\t\tconst exists = this._children.some((child) => child.domNode === node);\n\t\t\t\tif (!exists) {\n\t\t\t\t\tnode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(node));\n\t\t\t\t\tthis._render();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _render() {\n\t\t\tif (this._projector) {\n\t\t\t\tthis._projector.invalidate();\n\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('dojo-ce-render', {\n\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\tdetail: this\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic __properties__() {\n\t\t\treturn { ...this._properties, ...this._eventProperties };\n\t\t}\n\n\t\tpublic __children__() {\n\t\t\tif (childType === CustomElementChildType.DOJO) {\n\t\t\t\treturn this._children.filter((Child) => Child.domNode.isWidget).map((Child: any) => {\n\t\t\t\t\tconst { domNode } = Child;\n\t\t\t\t\treturn w(Child, { ...domNode.__properties__() }, [...domNode.__children__()]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this._children;\n\t\t\t}\n\t\t}\n\n\t\tpublic attributeChangedCallback(name: string, oldValue: string | null, value: string | null) {\n\t\t\tconst propertyName = attributeMap[name];\n\t\t\tthis._setProperty(propertyName, value);\n\t\t}\n\n\t\tprivate _setEventProperty(propertyName: string, value: any) {\n\t\t\tthis._eventProperties[propertyName] = value;\n\t\t}\n\n\t\tprivate _getEventProperty(propertyName: string) {\n\t\t\treturn this._eventProperties[propertyName];\n\t\t}\n\n\t\tprivate _setProperty(propertyName: string, value: any) {\n\t\t\tif (typeof value === 'function') {\n\t\t\t\tvalue[noBind] = true;\n\t\t\t}\n\t\t\tthis._properties[propertyName] = value;\n\t\t\tthis._render();\n\t\t}\n\n\t\tprivate _getProperty(propertyName: string) {\n\t\t\treturn this._properties[propertyName];\n\t\t}\n\n\t\tprivate _attributesToProperties(attributes: string[]) {\n\t\t\treturn attributes.reduce((properties: any, propertyName: string) => {\n\t\t\t\tconst attributeName = propertyName.toLowerCase();\n\t\t\t\tconst value = this.getAttribute(attributeName);\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tproperties[propertyName] = value;\n\t\t\t\t}\n\t\t\t\treturn properties;\n\t\t\t}, {});\n\t\t}\n\n\t\tstatic get observedAttributes() {\n\t\t\treturn Object.keys(attributeMap);\n\t\t}\n\n\t\tpublic get isWidget() {\n\t\t\treturn true;\n\t\t}\n\t};\n}\n\nexport function register(WidgetConstructor: any): void {\n\tconst descriptor = WidgetConstructor.prototype && WidgetConstructor.prototype.__customElementDescriptor;\n\n\tif (!descriptor) {\n\t\tthrow new Error(\n\t\t\t'Cannot get descriptor for Custom Element, have you added the @customElement decorator to your Widget?'\n\t\t);\n\t}\n\n\tglobal.customElements.define(descriptor.tagName, create(descriptor, WidgetConstructor));\n}\n\nexport default register;\n"]}