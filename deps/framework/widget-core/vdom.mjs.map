{"version":3,"file":"vdom.mjs","sourceRoot":"","sources":["../../../../src/widget-core/vdom.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '../shim/global';\nimport {\n\tCoreProperties,\n\tDefaultWidgetBaseInterface,\n\tDNode,\n\tVNode,\n\tWNode,\n\tProjectionOptions,\n\tProjection,\n\tSupportedClassName,\n\tTransitionStrategy,\n\tVNodeProperties\n} from './interfaces';\nimport { from as arrayFrom } from '../shim/array';\nimport { isWNode, isVNode, isDomVNode, VNODE, WNODE } from './d';\nimport { isWidgetBaseConstructor } from './Registry';\nimport WeakMap from '../shim/WeakMap';\nimport NodeHandler from './NodeHandler';\nimport RegistryHandler from './RegistryHandler';\n\nconst NAMESPACE_W3 = 'http://www.w3.org/';\nconst NAMESPACE_SVG = NAMESPACE_W3 + '2000/svg';\nconst NAMESPACE_XLINK = NAMESPACE_W3 + '1999/xlink';\n\nconst emptyArray: (InternalWNode | InternalVNode)[] = [];\n\nconst nodeOperations = ['focus', 'blur', 'scrollIntoView', 'click'];\n\nexport type RenderResult = DNode<any> | DNode<any>[];\n\ninterface InstanceMapData {\n\tparentVNode: InternalVNode;\n\tdnode: InternalWNode;\n}\n\nexport interface InternalWNode extends WNode<DefaultWidgetBaseInterface> {\n\t/**\n\t * The instance of the widget\n\t */\n\tinstance: DefaultWidgetBaseInterface;\n\n\t/**\n\t * The rendered DNodes from the instance\n\t */\n\trendered: InternalDNode[];\n\n\t/**\n\t * Core properties that are used by the widget core system\n\t */\n\tcoreProperties: CoreProperties;\n\n\t/**\n\t * Children for the WNode\n\t */\n\tchildren: InternalDNode[];\n}\n\nexport interface InternalVNode extends VNode {\n\t/**\n\t * Children for the VNode\n\t */\n\tchildren?: InternalDNode[];\n\n\tinserted?: boolean;\n\n\t/**\n\t * Bag used to still decorate properties on a deferred properties callback\n\t */\n\tdecoratedDeferredProperties?: VNodeProperties;\n\n\t/**\n\t * DOM element\n\t */\n\tdomNode?: Element | Text;\n}\n\nexport type InternalDNode = InternalVNode | InternalWNode;\n\nexport interface RenderQueue {\n\tinstance: DefaultWidgetBaseInterface;\n\tdepth: number;\n}\n\nexport interface WidgetData {\n\tonDetach: () => void;\n\tonAttach: () => void;\n\tdirty: boolean;\n\tregistry: () => RegistryHandler;\n\tnodeHandler: NodeHandler;\n\tcoreProperties: CoreProperties;\n\tinvalidate?: Function;\n\trendering: boolean;\n\tinputProperties: any;\n}\n\ninterface ProjectorState {\n\tdeferredRenderCallbacks: Function[];\n\tafterRenderCallbacks: Function[];\n\tnodeMap: WeakMap<Node, WeakMap<Function, EventListener>>;\n\trenderScheduled?: number;\n\trenderQueue: RenderQueue[];\n\tmerge: boolean;\n\tmergeElement?: Node;\n}\n\nexport const widgetInstanceMap = new WeakMap<any, WidgetData>();\n\nconst instanceMap = new WeakMap<DefaultWidgetBaseInterface, InstanceMapData>();\nconst nextSiblingMap = new WeakMap<DefaultWidgetBaseInterface, InternalDNode[]>();\nconst projectorStateMap = new WeakMap<DefaultWidgetBaseInterface, ProjectorState>();\n\nfunction same(dnode1: InternalDNode, dnode2: InternalDNode) {\n\tif (isVNode(dnode1) && isVNode(dnode2)) {\n\t\tif (isDomVNode(dnode1) || isDomVNode(dnode2)) {\n\t\t\tif (dnode1.domNode !== dnode2.domNode) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tif (dnode1.tag !== dnode2.tag) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.properties.key !== dnode2.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t} else if (isWNode(dnode1) && isWNode(dnode2)) {\n\t\tif (dnode1.instance === undefined && typeof dnode2.widgetConstructor === 'string') {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.widgetConstructor !== dnode2.widgetConstructor) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.properties.key !== dnode2.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nconst missingTransition = function() {\n\tthrow new Error('Provide a transitions object to the projectionOptions to do animations');\n};\n\nfunction getProjectionOptions(\n\tprojectorOptions: Partial<ProjectionOptions>,\n\tprojectorInstance: DefaultWidgetBaseInterface\n): ProjectionOptions {\n\tconst defaults: Partial<ProjectionOptions> = {\n\t\tnamespace: undefined,\n\t\tstyleApplyer: function(domNode: HTMLElement, styleName: string, value: string) {\n\t\t\t(domNode.style as any)[styleName] = value;\n\t\t},\n\t\ttransitions: {\n\t\t\tenter: missingTransition,\n\t\t\texit: missingTransition\n\t\t},\n\t\tdepth: 0,\n\t\tmerge: false,\n\t\tsync: false,\n\t\tprojectorInstance\n\t};\n\treturn { ...defaults, ...projectorOptions } as ProjectionOptions;\n}\n\nfunction checkStyleValue(styleValue: Object) {\n\tif (typeof styleValue !== 'string') {\n\t\tthrow new Error('Style values must be strings');\n\t}\n}\n\nfunction updateEvent(\n\tdomNode: Node,\n\teventName: string,\n\tcurrentValue: Function,\n\tprojectionOptions: ProjectionOptions,\n\tbind: any,\n\tpreviousValue?: Function\n) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tconst eventMap = projectorState.nodeMap.get(domNode) || new WeakMap();\n\n\tif (previousValue) {\n\t\tconst previousEvent = eventMap.get(previousValue);\n\t\tdomNode.removeEventListener(eventName, previousEvent);\n\t}\n\n\tlet callback = currentValue.bind(bind);\n\n\tif (eventName === 'input') {\n\t\tcallback = function(this: any, evt: Event) {\n\t\t\tcurrentValue.call(this, evt);\n\t\t\t(evt.target as any)['oninput-value'] = (evt.target as HTMLInputElement).value;\n\t\t}.bind(bind);\n\t}\n\n\tdomNode.addEventListener(eventName, callback);\n\teventMap.set(currentValue, callback);\n\tprojectorState.nodeMap.set(domNode, eventMap);\n}\n\nfunction addClasses(domNode: Element, classes: SupportedClassName) {\n\tif (classes) {\n\t\tconst classNames = classes.split(' ');\n\t\tfor (let i = 0; i < classNames.length; i++) {\n\t\t\tdomNode.classList.add(classNames[i]);\n\t\t}\n\t}\n}\n\nfunction removeClasses(domNode: Element, classes: SupportedClassName) {\n\tif (classes) {\n\t\tconst classNames = classes.split(' ');\n\t\tfor (let i = 0; i < classNames.length; i++) {\n\t\t\tdomNode.classList.remove(classNames[i]);\n\t\t}\n\t}\n}\n\nfunction buildPreviousProperties(domNode: any, previous: InternalVNode, current: InternalVNode) {\n\tconst { diffType, properties, attributes } = current;\n\tif (!diffType || diffType === 'vdom') {\n\t\treturn { properties: previous.properties, attributes: previous.attributes, events: previous.events };\n\t} else if (diffType === 'none') {\n\t\treturn { properties: {}, attributes: previous.attributes ? {} : undefined, events: previous.events };\n\t}\n\tlet newProperties: any = {\n\t\tproperties: {}\n\t};\n\tif (attributes) {\n\t\tnewProperties.attributes = {};\n\t\tnewProperties.events = previous.events;\n\t\tObject.keys(properties).forEach((propName) => {\n\t\t\tnewProperties.properties[propName] = domNode[propName];\n\t\t});\n\t\tObject.keys(attributes).forEach((attrName) => {\n\t\t\tnewProperties.attributes[attrName] = domNode.getAttribute(attrName);\n\t\t});\n\t\treturn newProperties;\n\t}\n\tnewProperties.properties = Object.keys(properties).reduce(\n\t\t(props, property) => {\n\t\t\tprops[property] = domNode.getAttribute(property) || domNode[property];\n\t\t\treturn props;\n\t\t},\n\t\t{} as any\n\t);\n\treturn newProperties;\n}\n\nfunction nodeOperation(\n\tpropName: string,\n\tpropValue: any,\n\tpreviousValue: any,\n\tdomNode: Element,\n\tprojectionOptions: ProjectionOptions\n): void {\n\tlet result;\n\tif (typeof propValue === 'function') {\n\t\tresult = propValue();\n\t} else {\n\t\tresult = propValue && !previousValue;\n\t}\n\tif (result === true) {\n\t\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\t\tprojectorState.deferredRenderCallbacks.push(() => {\n\t\t\t(domNode as any)[propName]();\n\t\t});\n\t}\n}\n\nfunction removeOrphanedEvents(\n\tdomNode: Element,\n\tpreviousProperties: VNodeProperties,\n\tproperties: VNodeProperties,\n\tprojectionOptions: ProjectionOptions,\n\tonlyEvents: boolean = false\n) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tconst eventMap = projectorState.nodeMap.get(domNode);\n\tif (eventMap) {\n\t\tObject.keys(previousProperties).forEach((propName) => {\n\t\t\tconst isEvent = propName.substr(0, 2) === 'on' || onlyEvents;\n\t\t\tconst eventName = onlyEvents ? propName : propName.substr(2);\n\t\t\tif (isEvent && !properties[propName]) {\n\t\t\t\tconst eventCallback = eventMap.get(previousProperties[propName]);\n\t\t\t\tif (eventCallback) {\n\t\t\t\t\tdomNode.removeEventListener(eventName, eventCallback);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction updateAttribute(domNode: Element, attrName: string, attrValue: string, projectionOptions: ProjectionOptions) {\n\tif (projectionOptions.namespace === NAMESPACE_SVG && attrName === 'href') {\n\t\tdomNode.setAttributeNS(NAMESPACE_XLINK, attrName, attrValue);\n\t} else if ((attrName === 'role' && attrValue === '') || attrValue === undefined) {\n\t\tdomNode.removeAttribute(attrName);\n\t} else {\n\t\tdomNode.setAttribute(attrName, attrValue);\n\t}\n}\n\nfunction updateAttributes(\n\tdomNode: Element,\n\tpreviousAttributes: { [index: string]: string },\n\tattributes: { [index: string]: string },\n\tprojectionOptions: ProjectionOptions\n) {\n\tconst attrNames = Object.keys(attributes);\n\tconst attrCount = attrNames.length;\n\tfor (let i = 0; i < attrCount; i++) {\n\t\tconst attrName = attrNames[i];\n\t\tconst attrValue = attributes[attrName];\n\t\tconst previousAttrValue = previousAttributes[attrName];\n\t\tif (attrValue !== previousAttrValue) {\n\t\t\tupdateAttribute(domNode, attrName, attrValue, projectionOptions);\n\t\t}\n\t}\n}\n\nfunction updateProperties(\n\tdomNode: Element,\n\tpreviousProperties: VNodeProperties,\n\tproperties: VNodeProperties,\n\tprojectionOptions: ProjectionOptions,\n\tincludesEventsAndAttributes = true\n) {\n\tlet propertiesUpdated = false;\n\tconst propNames = Object.keys(properties);\n\tconst propCount = propNames.length;\n\tif (propNames.indexOf('classes') === -1 && previousProperties.classes) {\n\t\tif (Array.isArray(previousProperties.classes)) {\n\t\t\tfor (let i = 0; i < previousProperties.classes.length; i++) {\n\t\t\t\tremoveClasses(domNode, previousProperties.classes[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tremoveClasses(domNode, previousProperties.classes);\n\t\t}\n\t}\n\n\tincludesEventsAndAttributes && removeOrphanedEvents(domNode, previousProperties, properties, projectionOptions);\n\n\tfor (let i = 0; i < propCount; i++) {\n\t\tconst propName = propNames[i];\n\t\tlet propValue = properties[propName];\n\t\tconst previousValue = previousProperties![propName];\n\t\tif (propName === 'classes') {\n\t\t\tconst previousClasses = Array.isArray(previousValue) ? previousValue : [previousValue];\n\t\t\tconst currentClasses = Array.isArray(propValue) ? propValue : [propValue];\n\t\t\tif (previousClasses && previousClasses.length > 0) {\n\t\t\t\tif (!propValue || propValue.length === 0) {\n\t\t\t\t\tfor (let i = 0; i < previousClasses.length; i++) {\n\t\t\t\t\t\tremoveClasses(domNode, previousClasses[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst newClasses: (null | undefined | string)[] = [...currentClasses];\n\t\t\t\t\tfor (let i = 0; i < previousClasses.length; i++) {\n\t\t\t\t\t\tconst previousClassName = previousClasses[i];\n\t\t\t\t\t\tif (previousClassName) {\n\t\t\t\t\t\t\tconst classIndex = newClasses.indexOf(previousClassName);\n\t\t\t\t\t\t\tif (classIndex === -1) {\n\t\t\t\t\t\t\t\tremoveClasses(domNode, previousClassName);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewClasses.splice(classIndex, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = 0; i < newClasses.length; i++) {\n\t\t\t\t\t\taddClasses(domNode, newClasses[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < currentClasses.length; i++) {\n\t\t\t\t\taddClasses(domNode, currentClasses[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (nodeOperations.indexOf(propName) !== -1) {\n\t\t\tnodeOperation(propName, propValue, previousValue, domNode, projectionOptions);\n\t\t} else if (propName === 'styles') {\n\t\t\tconst styleNames = Object.keys(propValue);\n\t\t\tconst styleCount = styleNames.length;\n\t\t\tfor (let j = 0; j < styleCount; j++) {\n\t\t\t\tconst styleName = styleNames[j];\n\t\t\t\tconst newStyleValue = propValue[styleName];\n\t\t\t\tconst oldStyleValue = previousValue && previousValue[styleName];\n\t\t\t\tif (newStyleValue === oldStyleValue) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tpropertiesUpdated = true;\n\t\t\t\tif (newStyleValue) {\n\t\t\t\t\tcheckStyleValue(newStyleValue);\n\t\t\t\t\tprojectionOptions.styleApplyer!(domNode as HTMLElement, styleName, newStyleValue);\n\t\t\t\t} else {\n\t\t\t\t\tprojectionOptions.styleApplyer!(domNode as HTMLElement, styleName, '');\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!propValue && typeof previousValue === 'string') {\n\t\t\t\tpropValue = '';\n\t\t\t}\n\t\t\tif (propName === 'value') {\n\t\t\t\tconst domValue = (domNode as any)[propName];\n\t\t\t\tif (\n\t\t\t\t\tdomValue !== propValue &&\n\t\t\t\t\t((domNode as any)['oninput-value']\n\t\t\t\t\t\t? domValue === (domNode as any)['oninput-value']\n\t\t\t\t\t\t: propValue !== previousValue)\n\t\t\t\t) {\n\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t(domNode as any)['oninput-value'] = undefined;\n\t\t\t\t}\n\t\t\t\tif (propValue !== previousValue) {\n\t\t\t\t\tpropertiesUpdated = true;\n\t\t\t\t}\n\t\t\t} else if (propName !== 'key' && propValue !== previousValue) {\n\t\t\t\tconst type = typeof propValue;\n\t\t\t\tif (type === 'function' && propName.lastIndexOf('on', 0) === 0 && includesEventsAndAttributes) {\n\t\t\t\t\tupdateEvent(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tpropName.substr(2),\n\t\t\t\t\t\tpropValue,\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tproperties.bind,\n\t\t\t\t\t\tpreviousValue\n\t\t\t\t\t);\n\t\t\t\t} else if (type === 'string' && propName !== 'innerHTML' && includesEventsAndAttributes) {\n\t\t\t\t\tupdateAttribute(domNode, propName, propValue, projectionOptions);\n\t\t\t\t} else if (propName === 'scrollLeft' || propName === 'scrollTop') {\n\t\t\t\t\tif ((domNode as any)[propName] !== propValue) {\n\t\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t}\n\t\t\t\tpropertiesUpdated = true;\n\t\t\t}\n\t\t}\n\t}\n\treturn propertiesUpdated;\n}\n\nfunction findIndexOfChild(children: InternalDNode[], sameAs: InternalDNode, start: number) {\n\tfor (let i = start; i < children.length; i++) {\n\t\tif (same(children[i], sameAs)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\nexport function toParentVNode(domNode: Element): InternalVNode {\n\treturn {\n\t\ttag: '',\n\t\tproperties: {},\n\t\tchildren: undefined,\n\t\tdomNode,\n\t\ttype: VNODE\n\t};\n}\n\nexport function toTextVNode(data: any): InternalVNode {\n\treturn {\n\t\ttag: '',\n\t\tproperties: {},\n\t\tchildren: undefined,\n\t\ttext: `${data}`,\n\t\tdomNode: undefined,\n\t\ttype: VNODE\n\t};\n}\n\nfunction toInternalWNode(instance: DefaultWidgetBaseInterface, instanceData: WidgetData): InternalWNode {\n\treturn {\n\t\tinstance,\n\t\trendered: [],\n\t\tcoreProperties: instanceData.coreProperties,\n\t\tchildren: instance.children as any,\n\t\twidgetConstructor: instance.constructor as any,\n\t\tproperties: instanceData.inputProperties,\n\t\ttype: WNODE\n\t};\n}\n\nexport function filterAndDecorateChildren(\n\tchildren: undefined | DNode | DNode[],\n\tinstance: DefaultWidgetBaseInterface\n): InternalDNode[] {\n\tif (children === undefined) {\n\t\treturn emptyArray;\n\t}\n\tchildren = Array.isArray(children) ? children : [children];\n\n\tfor (let i = 0; i < children.length; ) {\n\t\tconst child = children[i] as InternalDNode;\n\t\tif (child === undefined || child === null) {\n\t\t\tchildren.splice(i, 1);\n\t\t\tcontinue;\n\t\t} else if (typeof child === 'string') {\n\t\t\tchildren[i] = toTextVNode(child);\n\t\t} else {\n\t\t\tif (isVNode(child)) {\n\t\t\t\tif (child.properties.bind === undefined) {\n\t\t\t\t\t(child.properties as any).bind = instance;\n\t\t\t\t\tif (child.children && child.children.length > 0) {\n\t\t\t\t\t\tfilterAndDecorateChildren(child.children, instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!child.coreProperties) {\n\t\t\t\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\t\t\t\tchild.coreProperties = {\n\t\t\t\t\t\tbind: instance,\n\t\t\t\t\t\tbaseRegistry: instanceData.coreProperties.baseRegistry\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (child.children && child.children.length > 0) {\n\t\t\t\t\tfilterAndDecorateChildren(child.children, instance);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ti++;\n\t}\n\treturn children as InternalDNode[];\n}\n\nfunction nodeAdded(dnode: InternalDNode, transitions: TransitionStrategy) {\n\tif (isVNode(dnode) && dnode.properties) {\n\t\tconst enterAnimation = dnode.properties.enterAnimation;\n\t\tif (enterAnimation) {\n\t\t\tif (typeof enterAnimation === 'function') {\n\t\t\t\tenterAnimation(dnode.domNode as Element, dnode.properties);\n\t\t\t} else {\n\t\t\t\ttransitions.enter(dnode.domNode as Element, dnode.properties, enterAnimation as string);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction nodeToRemove(dnode: InternalDNode, transitions: TransitionStrategy, projectionOptions: ProjectionOptions) {\n\tif (isWNode(dnode)) {\n\t\tconst item = instanceMap.get(dnode.instance);\n\t\tconst rendered = (item ? item.dnode.rendered : dnode.rendered) || emptyArray;\n\t\tif (dnode.instance) {\n\t\t\tconst instanceData = widgetInstanceMap.get(dnode.instance)!;\n\t\t\tinstanceData.onDetach();\n\t\t\tinstanceMap.delete(dnode.instance);\n\t\t}\n\t\tfor (let i = 0; i < rendered.length; i++) {\n\t\t\tnodeToRemove(rendered[i], transitions, projectionOptions);\n\t\t}\n\t} else {\n\t\tconst domNode = dnode.domNode;\n\t\tconst properties = dnode.properties;\n\t\tif (dnode.children && dnode.children.length > 0) {\n\t\t\tfor (let i = 0; i < dnode.children.length; i++) {\n\t\t\t\tnodeToRemove(dnode.children[i], transitions, projectionOptions);\n\t\t\t}\n\t\t}\n\t\tconst exitAnimation = properties.exitAnimation;\n\t\tif (properties && exitAnimation) {\n\t\t\t(domNode as HTMLElement).style.pointerEvents = 'none';\n\t\t\tconst removeDomNode = function() {\n\t\t\t\tdomNode && domNode.parentNode && domNode.parentNode.removeChild(domNode);\n\t\t\t\tdnode.domNode = undefined;\n\t\t\t};\n\t\t\tif (typeof exitAnimation === 'function') {\n\t\t\t\texitAnimation(domNode as Element, removeDomNode, properties);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\ttransitions.exit(dnode.domNode as Element, properties, exitAnimation as string, removeDomNode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tdomNode && domNode.parentNode && domNode.parentNode.removeChild(domNode);\n\t\tdnode.domNode = undefined;\n\t}\n}\n\nfunction checkDistinguishable(\n\tchildNodes: InternalDNode[],\n\tindexToCheck: number,\n\tparentInstance: DefaultWidgetBaseInterface\n) {\n\tconst childNode = childNodes[indexToCheck];\n\tif (isVNode(childNode) && !childNode.tag) {\n\t\treturn; // Text nodes need not be distinguishable\n\t}\n\tconst { key } = childNode.properties;\n\n\tif (key === undefined || key === null) {\n\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\tif (i !== indexToCheck) {\n\t\t\t\tconst node = childNodes[i];\n\t\t\t\tif (same(node, childNode)) {\n\t\t\t\t\tlet nodeIdentifier: string;\n\t\t\t\t\tconst parentName = (parentInstance as any).constructor.name || 'unknown';\n\t\t\t\t\tif (isWNode(childNode)) {\n\t\t\t\t\t\tnodeIdentifier = (childNode.widgetConstructor as any).name || 'unknown';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnodeIdentifier = childNode.tag;\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`A widget (${parentName}) has had a child addded or removed, but they were not able to uniquely identified. It is recommended to provide a unique 'key' property when using the same widget or element (${nodeIdentifier}) multiple times as siblings`\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateChildren(\n\tparentVNode: InternalVNode,\n\tsiblings: InternalDNode[],\n\toldChildren: InternalDNode[],\n\tnewChildren: InternalDNode[],\n\tparentInstance: DefaultWidgetBaseInterface,\n\tprojectionOptions: ProjectionOptions\n) {\n\toldChildren = oldChildren || emptyArray;\n\tnewChildren = newChildren;\n\tconst oldChildrenLength = oldChildren.length;\n\tconst newChildrenLength = newChildren.length;\n\tconst transitions = projectionOptions.transitions!;\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tprojectionOptions = { ...projectionOptions, depth: projectionOptions.depth + 1 };\n\tlet oldIndex = 0;\n\tlet newIndex = 0;\n\tlet i: number;\n\tlet textUpdated = false;\n\twhile (newIndex < newChildrenLength) {\n\t\tlet oldChild = oldIndex < oldChildrenLength ? oldChildren[oldIndex] : undefined;\n\t\tconst newChild = newChildren[newIndex];\n\t\tif (isVNode(newChild) && typeof newChild.deferredPropertiesCallback === 'function') {\n\t\t\tnewChild.inserted = isVNode(oldChild) && oldChild.inserted;\n\t\t\taddDeferredProperties(newChild, projectionOptions);\n\t\t}\n\t\tif (oldChild !== undefined && same(oldChild, newChild)) {\n\t\t\toldIndex++;\n\t\t\tnewIndex++;\n\t\t\ttextUpdated =\n\t\t\t\tupdateDom(\n\t\t\t\t\toldChild,\n\t\t\t\t\tnewChild,\n\t\t\t\t\tprojectionOptions,\n\t\t\t\t\tparentVNode,\n\t\t\t\t\tparentInstance,\n\t\t\t\t\toldChildren.slice(oldIndex),\n\t\t\t\t\tnewChildren.slice(newIndex)\n\t\t\t\t) || textUpdated;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst findOldIndex = findIndexOfChild(oldChildren, newChild, oldIndex + 1);\n\t\tconst addChild = () => {\n\t\t\tlet insertBeforeDomNode: Node | undefined = undefined;\n\t\t\tlet childrenArray = oldChildren;\n\t\t\tlet nextIndex = oldIndex + 1;\n\t\t\tlet child: InternalDNode = oldChildren[oldIndex];\n\t\t\tif (!child) {\n\t\t\t\tchild = siblings[0];\n\t\t\t\tnextIndex = 1;\n\t\t\t\tchildrenArray = siblings;\n\t\t\t}\n\t\t\tif (child) {\n\t\t\t\tlet insertBeforeChildren = [child];\n\t\t\t\twhile (insertBeforeChildren.length) {\n\t\t\t\t\tconst insertBefore = insertBeforeChildren.shift()!;\n\t\t\t\t\tif (isWNode(insertBefore)) {\n\t\t\t\t\t\tconst item = instanceMap.get(insertBefore.instance);\n\t\t\t\t\t\tif (item && item.dnode.rendered) {\n\t\t\t\t\t\t\tinsertBeforeChildren.push(...item.dnode.rendered);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (insertBefore.domNode) {\n\t\t\t\t\t\t\tif (insertBefore.domNode.parentElement !== parentVNode.domNode) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinsertBeforeDomNode = insertBefore.domNode;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (insertBeforeChildren.length === 0 && childrenArray[nextIndex]) {\n\t\t\t\t\t\tinsertBeforeChildren.push(childrenArray[nextIndex]);\n\t\t\t\t\t\tnextIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcreateDom(\n\t\t\t\tnewChild,\n\t\t\t\tparentVNode,\n\t\t\t\tnewChildren.slice(newIndex + 1),\n\t\t\t\tinsertBeforeDomNode,\n\t\t\t\tprojectionOptions,\n\t\t\t\tparentInstance\n\t\t\t);\n\t\t\tnodeAdded(newChild, transitions);\n\t\t\tconst indexToCheck = newIndex;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(newChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t};\n\n\t\tif (!oldChild || findOldIndex === -1) {\n\t\t\taddChild();\n\t\t\tnewIndex++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst removeChild = () => {\n\t\t\tconst indexToCheck = oldIndex;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(oldChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t\tif (isWNode(oldChild)) {\n\t\t\t\tconst item = instanceMap.get(oldChild.instance);\n\t\t\t\tif (item) {\n\t\t\t\t\toldChild = item.dnode;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnodeToRemove(oldChild!, transitions, projectionOptions);\n\t\t};\n\t\tconst findNewIndex = findIndexOfChild(newChildren, oldChild, newIndex + 1);\n\n\t\tif (findNewIndex === -1) {\n\t\t\tremoveChild();\n\t\t\toldIndex++;\n\t\t\tcontinue;\n\t\t}\n\n\t\taddChild();\n\t\tremoveChild();\n\t\toldIndex++;\n\t\tnewIndex++;\n\t}\n\tif (oldChildrenLength > oldIndex) {\n\t\t// Remove child fragments\n\t\tfor (i = oldIndex; i < oldChildrenLength; i++) {\n\t\t\tconst indexToCheck = i;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(oldChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t\tlet childToRemove = oldChildren[i];\n\t\t\tif (isWNode(childToRemove)) {\n\t\t\t\tconst item = instanceMap.get(childToRemove.instance);\n\t\t\t\tif (item) {\n\t\t\t\t\tchildToRemove = item.dnode;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnodeToRemove(childToRemove, transitions, projectionOptions);\n\t\t}\n\t}\n\treturn textUpdated;\n}\n\nfunction addChildren(\n\tparentVNode: InternalVNode,\n\tchildren: InternalDNode[] | undefined,\n\tprojectionOptions: ProjectionOptions,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tinsertBefore: Node | undefined = undefined,\n\tchildNodes?: (Element | Text)[]\n) {\n\tif (children === undefined) {\n\t\treturn;\n\t}\n\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectorState.merge && childNodes === undefined) {\n\t\tchildNodes = arrayFrom(parentVNode.domNode!.childNodes) as (Element | Text)[];\n\t}\n\tconst transitions = projectionOptions.transitions!;\n\tprojectionOptions = { ...projectionOptions, depth: projectionOptions.depth + 1 };\n\n\tfor (let i = 0; i < children.length; i++) {\n\t\tconst child = children[i];\n\t\tconst nextSiblings = children.slice(i + 1);\n\n\t\tif (isVNode(child)) {\n\t\t\tif (projectorState.merge && childNodes) {\n\t\t\t\tlet domElement: Element | undefined = undefined;\n\t\t\t\twhile (child.domNode === undefined && childNodes.length > 0) {\n\t\t\t\t\tdomElement = childNodes.shift() as Element;\n\t\t\t\t\tif (domElement && domElement.tagName === (child.tag.toUpperCase() || undefined)) {\n\t\t\t\t\t\tchild.domNode = domElement;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcreateDom(child, parentVNode, nextSiblings, insertBefore, projectionOptions, parentInstance);\n\t\t} else {\n\t\t\tcreateDom(child, parentVNode, nextSiblings, insertBefore, projectionOptions, parentInstance, childNodes);\n\t\t}\n\t\tnodeAdded(child, transitions);\n\t}\n}\n\nfunction initPropertiesAndChildren(\n\tdomNode: Element,\n\tdnode: InternalVNode,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tprojectionOptions: ProjectionOptions\n) {\n\taddChildren(dnode, dnode.children, projectionOptions, parentInstance, undefined);\n\tif (typeof dnode.deferredPropertiesCallback === 'function' && dnode.inserted === undefined) {\n\t\taddDeferredProperties(dnode, projectionOptions);\n\t}\n\n\tif (dnode.attributes && dnode.events) {\n\t\tupdateAttributes(domNode, {}, dnode.attributes, projectionOptions);\n\t\tupdateProperties(domNode, {}, dnode.properties, projectionOptions, false);\n\t\tremoveOrphanedEvents(domNode, {}, dnode.events, projectionOptions, true);\n\t\tconst events = dnode.events;\n\t\tObject.keys(events).forEach((event) => {\n\t\t\tupdateEvent(domNode, event, events[event], projectionOptions, dnode.properties.bind);\n\t\t});\n\t} else {\n\t\tupdateProperties(domNode, {}, dnode.properties, projectionOptions);\n\t}\n\tif (dnode.properties.key !== null && dnode.properties.key !== undefined) {\n\t\tconst instanceData = widgetInstanceMap.get(parentInstance)!;\n\t\tinstanceData.nodeHandler.add(domNode as HTMLElement, `${dnode.properties.key}`);\n\t}\n\tdnode.inserted = true;\n}\n\nfunction createDom(\n\tdnode: InternalDNode,\n\tparentVNode: InternalVNode,\n\tnextSiblings: InternalDNode[],\n\tinsertBefore: Node | undefined,\n\tprojectionOptions: ProjectionOptions,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tchildNodes?: (Element | Text)[]\n) {\n\tlet domNode: Element | Text | undefined;\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (isWNode(dnode)) {\n\t\tlet { widgetConstructor } = dnode;\n\t\tconst parentInstanceData = widgetInstanceMap.get(parentInstance)!;\n\t\tif (!isWidgetBaseConstructor<DefaultWidgetBaseInterface>(widgetConstructor)) {\n\t\t\tconst item = parentInstanceData.registry().get<DefaultWidgetBaseInterface>(widgetConstructor);\n\t\t\tif (item === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twidgetConstructor = item;\n\t\t}\n\t\tconst instance = new widgetConstructor();\n\t\tdnode.instance = instance;\n\t\tnextSiblingMap.set(instance, nextSiblings);\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tinstanceData.invalidate = () => {\n\t\t\tinstanceData.dirty = true;\n\t\t\tif (instanceData.rendering === false) {\n\t\t\t\tprojectorState.renderQueue.push({ instance, depth: projectionOptions.depth });\n\t\t\t\tscheduleRender(projectionOptions);\n\t\t\t}\n\t\t};\n\t\tinstanceData.rendering = true;\n\t\tinstance.__setCoreProperties__(dnode.coreProperties);\n\t\tinstance.__setChildren__(dnode.children);\n\t\tinstance.__setProperties__(dnode.properties);\n\t\tconst rendered = instance.__render__();\n\t\tinstanceData.rendering = false;\n\t\tif (rendered) {\n\t\t\tconst filteredRendered = filterAndDecorateChildren(rendered, instance);\n\t\t\tdnode.rendered = filteredRendered;\n\t\t\taddChildren(parentVNode, filteredRendered, projectionOptions, instance, insertBefore, childNodes);\n\t\t}\n\t\tinstanceMap.set(instance, { dnode, parentVNode });\n\t\tinstanceData.nodeHandler.addRoot();\n\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\tinstanceData.onAttach();\n\t\t});\n\t} else {\n\t\tif (projectorState.merge && projectorState.mergeElement !== undefined) {\n\t\t\tdomNode = dnode.domNode = projectionOptions.mergeElement;\n\t\t\tprojectorState.mergeElement = undefined;\n\t\t\tinitPropertiesAndChildren(domNode!, dnode, parentInstance, projectionOptions);\n\t\t\treturn;\n\t\t}\n\t\tconst doc = parentVNode.domNode!.ownerDocument;\n\t\tif (!dnode.tag && typeof dnode.text === 'string') {\n\t\t\tif (dnode.domNode !== undefined && parentVNode.domNode) {\n\t\t\t\tconst newDomNode = dnode.domNode.ownerDocument.createTextNode(dnode.text!);\n\t\t\t\tif (parentVNode.domNode === dnode.domNode.parentNode) {\n\t\t\t\t\tparentVNode.domNode.replaceChild(newDomNode, dnode.domNode);\n\t\t\t\t} else {\n\t\t\t\t\tparentVNode.domNode.appendChild(newDomNode);\n\t\t\t\t\tdnode.domNode.parentNode && dnode.domNode.parentNode.removeChild(dnode.domNode);\n\t\t\t\t}\n\t\t\t\tdnode.domNode = newDomNode;\n\t\t\t} else {\n\t\t\t\tdomNode = dnode.domNode = doc.createTextNode(dnode.text!);\n\t\t\t\tif (insertBefore !== undefined) {\n\t\t\t\t\tparentVNode.domNode!.insertBefore(domNode, insertBefore);\n\t\t\t\t} else {\n\t\t\t\t\tparentVNode.domNode!.appendChild(domNode);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (dnode.domNode === undefined) {\n\t\t\t\tif (dnode.tag === 'svg') {\n\t\t\t\t\tprojectionOptions = { ...projectionOptions, ...{ namespace: NAMESPACE_SVG } };\n\t\t\t\t}\n\t\t\t\tif (projectionOptions.namespace !== undefined) {\n\t\t\t\t\tdomNode = dnode.domNode = doc.createElementNS(projectionOptions.namespace, dnode.tag);\n\t\t\t\t} else {\n\t\t\t\t\tdomNode = dnode.domNode = dnode.domNode || doc.createElement(dnode.tag);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdomNode = dnode.domNode;\n\t\t\t}\n\t\t\tinitPropertiesAndChildren(domNode! as Element, dnode, parentInstance, projectionOptions);\n\t\t\tif (insertBefore !== undefined) {\n\t\t\t\tparentVNode.domNode!.insertBefore(domNode, insertBefore);\n\t\t\t} else if (domNode!.parentNode !== parentVNode.domNode!) {\n\t\t\t\tparentVNode.domNode!.appendChild(domNode);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateDom(\n\tprevious: any,\n\tdnode: InternalDNode,\n\tprojectionOptions: ProjectionOptions,\n\tparentVNode: InternalVNode,\n\tparentInstance: DefaultWidgetBaseInterface,\n\toldNextSiblings: InternalDNode[],\n\tnextSiblings: InternalDNode[]\n) {\n\tif (isWNode(dnode)) {\n\t\tconst { instance } = previous;\n\t\tconst { parentVNode, dnode: node } = instanceMap.get(instance)!;\n\t\tconst previousRendered = node ? node.rendered : previous.rendered;\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tinstanceData.rendering = true;\n\t\tinstance.__setCoreProperties__(dnode.coreProperties);\n\t\tinstance.__setChildren__(dnode.children);\n\t\tinstance.__setProperties__(dnode.properties);\n\t\tnextSiblingMap.set(instance, nextSiblings);\n\t\tdnode.instance = instance;\n\t\tif (instanceData.dirty === true) {\n\t\t\tconst rendered = instance.__render__();\n\t\t\tinstanceData.rendering = false;\n\t\t\tdnode.rendered = filterAndDecorateChildren(rendered, instance);\n\t\t\tupdateChildren(parentVNode, oldNextSiblings, previousRendered, dnode.rendered, instance, projectionOptions);\n\t\t} else {\n\t\t\tinstanceData.rendering = false;\n\t\t\tdnode.rendered = previousRendered;\n\t\t}\n\t\tinstanceMap.set(instance, { dnode, parentVNode });\n\t\tinstanceData.nodeHandler.addRoot();\n\t} else {\n\t\tif (previous === dnode) {\n\t\t\treturn false;\n\t\t}\n\t\tconst domNode = (dnode.domNode = previous.domNode);\n\t\tlet textUpdated = false;\n\t\tlet updated = false;\n\t\tif (!dnode.tag && typeof dnode.text === 'string') {\n\t\t\tif (dnode.text !== previous.text) {\n\t\t\t\tconst newDomNode = domNode.ownerDocument.createTextNode(dnode.text!);\n\t\t\t\tdomNode.parentNode!.replaceChild(newDomNode, domNode);\n\t\t\t\tdnode.domNode = newDomNode;\n\t\t\t\ttextUpdated = true;\n\t\t\t\treturn textUpdated;\n\t\t\t}\n\t\t} else {\n\t\t\tif (dnode.tag && dnode.tag.lastIndexOf('svg', 0) === 0) {\n\t\t\t\tprojectionOptions = { ...projectionOptions, ...{ namespace: NAMESPACE_SVG } };\n\t\t\t}\n\t\t\tif (previous.children !== dnode.children) {\n\t\t\t\tconst children = filterAndDecorateChildren(dnode.children, parentInstance);\n\t\t\t\tdnode.children = children;\n\t\t\t\tupdated =\n\t\t\t\t\tupdateChildren(\n\t\t\t\t\t\tdnode,\n\t\t\t\t\t\toldNextSiblings,\n\t\t\t\t\t\tprevious.children,\n\t\t\t\t\t\tchildren,\n\t\t\t\t\t\tparentInstance,\n\t\t\t\t\t\tprojectionOptions\n\t\t\t\t\t) || updated;\n\t\t\t}\n\n\t\t\tconst previousProperties = buildPreviousProperties(domNode, previous, dnode);\n\t\t\tif (dnode.attributes && dnode.events) {\n\t\t\t\tupdateAttributes(domNode, previousProperties.attributes, dnode.attributes, projectionOptions);\n\t\t\t\tupdated =\n\t\t\t\t\tupdateProperties(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tpreviousProperties.properties,\n\t\t\t\t\t\tdnode.properties,\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t) || updated;\n\t\t\t\tremoveOrphanedEvents(domNode, previousProperties.events, dnode.events, projectionOptions, true);\n\t\t\t\tconst events = dnode.events;\n\t\t\t\tObject.keys(events).forEach((event) => {\n\t\t\t\t\tupdateEvent(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tevents[event],\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tdnode.properties.bind,\n\t\t\t\t\t\tpreviousProperties.events[event]\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tupdated =\n\t\t\t\t\tupdateProperties(domNode, previousProperties.properties, dnode.properties, projectionOptions) ||\n\t\t\t\t\tupdated;\n\t\t\t}\n\n\t\t\tif (dnode.properties.key !== null && dnode.properties.key !== undefined) {\n\t\t\t\tconst instanceData = widgetInstanceMap.get(parentInstance)!;\n\t\t\t\tinstanceData.nodeHandler.add(domNode, `${dnode.properties.key}`);\n\t\t\t}\n\t\t}\n\t\tif (updated && dnode.properties && dnode.properties.updateAnimation) {\n\t\t\tdnode.properties.updateAnimation(domNode as Element, dnode.properties, previous.properties);\n\t\t}\n\t}\n}\n\nfunction addDeferredProperties(vnode: InternalVNode, projectionOptions: ProjectionOptions) {\n\t// transfer any properties that have been passed - as these must be decorated properties\n\tvnode.decoratedDeferredProperties = vnode.properties;\n\tconst properties = vnode.deferredPropertiesCallback!(!!vnode.inserted);\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tvnode.properties = { ...properties, ...vnode.decoratedDeferredProperties };\n\tprojectorState.deferredRenderCallbacks.push(() => {\n\t\tconst properties = {\n\t\t\t...vnode.deferredPropertiesCallback!(!!vnode.inserted),\n\t\t\t...vnode.decoratedDeferredProperties\n\t\t};\n\t\tupdateProperties(vnode.domNode! as Element, vnode.properties, properties, projectionOptions);\n\t\tvnode.properties = properties;\n\t});\n}\n\nfunction runDeferredRenderCallbacks(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectorState.deferredRenderCallbacks.length) {\n\t\tif (projectionOptions.sync) {\n\t\t\twhile (projectorState.deferredRenderCallbacks.length) {\n\t\t\t\tconst callback = projectorState.deferredRenderCallbacks.shift();\n\t\t\t\tcallback && callback();\n\t\t\t}\n\t\t} else {\n\t\t\tglobal.requestAnimationFrame(() => {\n\t\t\t\twhile (projectorState.deferredRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.deferredRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction runAfterRenderCallbacks(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectionOptions.sync) {\n\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\tcallback && callback();\n\t\t}\n\t} else {\n\t\tif (global.requestIdleCallback) {\n\t\t\tglobal.requestIdleCallback(() => {\n\t\t\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction scheduleRender(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectionOptions.sync) {\n\t\trender(projectionOptions);\n\t} else if (projectorState.renderScheduled === undefined) {\n\t\tprojectorState.renderScheduled = global.requestAnimationFrame(() => {\n\t\t\trender(projectionOptions);\n\t\t});\n\t}\n}\n\nfunction render(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tprojectorState.renderScheduled = undefined;\n\tconst renderQueue = projectorState.renderQueue;\n\tconst renders = [...renderQueue];\n\tprojectorState.renderQueue = [];\n\trenders.sort((a, b) => a.depth - b.depth);\n\tconst previouslyRendered = [];\n\twhile (renders.length) {\n\t\tconst { instance } = renders.shift()!;\n\t\tif (instanceMap.has(instance) && previouslyRendered.indexOf(instance) === -1) {\n\t\t\tpreviouslyRendered.push(instance);\n\t\t\tconst { parentVNode, dnode } = instanceMap.get(instance)!;\n\t\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\t\tconst nextSiblings = nextSiblingMap.get(instance)!;\n\t\t\tupdateDom(\n\t\t\t\tdnode,\n\t\t\t\ttoInternalWNode(instance, instanceData),\n\t\t\t\tprojectionOptions,\n\t\t\t\tparentVNode,\n\t\t\t\tinstance,\n\t\t\t\tnextSiblings,\n\t\t\t\tnextSiblings\n\t\t\t);\n\t\t}\n\t}\n\trunAfterRenderCallbacks(projectionOptions);\n\trunDeferredRenderCallbacks(projectionOptions);\n}\n\nexport const dom = {\n\tappend: function(\n\t\tparentNode: Element,\n\t\tinstance: DefaultWidgetBaseInterface,\n\t\tprojectionOptions: Partial<ProjectionOptions> = {}\n\t): Projection {\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tconst finalProjectorOptions = getProjectionOptions(projectionOptions, instance);\n\t\tconst projectorState: ProjectorState = {\n\t\t\tafterRenderCallbacks: [],\n\t\t\tdeferredRenderCallbacks: [],\n\t\t\tnodeMap: new WeakMap(),\n\t\t\trenderScheduled: undefined,\n\t\t\trenderQueue: [],\n\t\t\tmerge: projectionOptions.merge || false,\n\t\t\tmergeElement: projectionOptions.mergeElement\n\t\t};\n\t\tprojectorStateMap.set(instance, projectorState);\n\n\t\tfinalProjectorOptions.rootNode = parentNode;\n\t\tconst parentVNode = toParentVNode(finalProjectorOptions.rootNode);\n\t\tconst node = toInternalWNode(instance, instanceData);\n\t\tinstanceMap.set(instance, { dnode: node, parentVNode });\n\t\tinstanceData.invalidate = () => {\n\t\t\tinstanceData.dirty = true;\n\t\t\tif (instanceData.rendering === false) {\n\t\t\t\tprojectorState.renderQueue.push({ instance, depth: finalProjectorOptions.depth });\n\t\t\t\tscheduleRender(finalProjectorOptions);\n\t\t\t}\n\t\t};\n\t\tupdateDom(node, node, finalProjectorOptions, parentVNode, instance, [], []);\n\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\tinstanceData.onAttach();\n\t\t});\n\t\trunDeferredRenderCallbacks(finalProjectorOptions);\n\t\trunAfterRenderCallbacks(finalProjectorOptions);\n\t\treturn {\n\t\t\tdomNode: finalProjectorOptions.rootNode\n\t\t};\n\t},\n\tcreate: function(instance: DefaultWidgetBaseInterface, projectionOptions?: Partial<ProjectionOptions>): Projection {\n\t\treturn this.append(document.createElement('div'), instance, projectionOptions);\n\t},\n\tmerge: function(\n\t\telement: Element,\n\t\tinstance: DefaultWidgetBaseInterface,\n\t\tprojectionOptions: Partial<ProjectionOptions> = {}\n\t): Projection {\n\t\tprojectionOptions.merge = true;\n\t\tprojectionOptions.mergeElement = element;\n\t\tconst projection = this.append(element.parentNode as Element, instance, projectionOptions);\n\t\tconst projectorState = projectorStateMap.get(instance)!;\n\t\tprojectorState.merge = false;\n\t\treturn projection;\n\t}\n};\n"]}