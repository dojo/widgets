{"version":3,"file":"vdom.js","sourceRoot":"","sources":["../../../../src/widget-core/vdom.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '../shim/global';\nimport {\n\tCoreProperties,\n\tDefaultWidgetBaseInterface,\n\tDNode,\n\tVNode,\n\tWNode,\n\tProjectionOptions,\n\tProjection,\n\tSupportedClassName,\n\tTransitionStrategy,\n\tVNodeProperties\n} from './interfaces';\nimport { from as arrayFrom } from '../shim/array';\nimport { isWNode, isVNode, isDomVNode, VNODE, WNODE } from './d';\nimport { isWidgetBaseConstructor } from './Registry';\nimport WeakMap from '../shim/WeakMap';\nimport NodeHandler from './NodeHandler';\nimport RegistryHandler from './RegistryHandler';\n\nconst NAMESPACE_W3 = 'http://www.w3.org/';\nconst NAMESPACE_SVG = NAMESPACE_W3 + '2000/svg';\nconst NAMESPACE_XLINK = NAMESPACE_W3 + '1999/xlink';\n\nconst emptyArray: (InternalWNode | InternalVNode)[] = [];\n\nconst nodeOperations = ['focus', 'blur', 'scrollIntoView', 'click'];\n\nexport type RenderResult = DNode<any> | DNode<any>[];\n\ninterface InstanceMapData {\n\tparentVNode: InternalVNode;\n\tdnode: InternalWNode;\n}\n\nexport interface InternalWNode extends WNode<DefaultWidgetBaseInterface> {\n\t/**\n\t * The instance of the widget\n\t */\n\tinstance: DefaultWidgetBaseInterface;\n\n\t/**\n\t * The rendered DNodes from the instance\n\t */\n\trendered: InternalDNode[];\n\n\t/**\n\t * Core properties that are used by the widget core system\n\t */\n\tcoreProperties: CoreProperties;\n\n\t/**\n\t * Children for the WNode\n\t */\n\tchildren: InternalDNode[];\n}\n\nexport interface InternalVNode extends VNode {\n\t/**\n\t * Children for the VNode\n\t */\n\tchildren?: InternalDNode[];\n\n\tinserted?: boolean;\n\n\t/**\n\t * Bag used to still decorate properties on a deferred properties callback\n\t */\n\tdecoratedDeferredProperties?: VNodeProperties;\n\n\t/**\n\t * DOM element\n\t */\n\tdomNode?: Element | Text;\n}\n\nexport type InternalDNode = InternalVNode | InternalWNode;\n\nexport interface RenderQueue {\n\tinstance: DefaultWidgetBaseInterface;\n\tdepth: number;\n}\n\nexport interface WidgetData {\n\tonDetach: () => void;\n\tonAttach: () => void;\n\tdirty: boolean;\n\tregistry: () => RegistryHandler;\n\tnodeHandler: NodeHandler;\n\tcoreProperties: CoreProperties;\n\tinvalidate?: Function;\n\trendering: boolean;\n\tinputProperties: any;\n}\n\ninterface ProjectorState {\n\tdeferredRenderCallbacks: Function[];\n\tafterRenderCallbacks: Function[];\n\tnodeMap: WeakMap<Node, WeakMap<Function, EventListener>>;\n\trenderScheduled?: number;\n\trenderQueue: RenderQueue[];\n\tmerge: boolean;\n\tmergeElement?: Node;\n}\n\nexport const widgetInstanceMap = new WeakMap<any, WidgetData>();\n\nconst instanceMap = new WeakMap<DefaultWidgetBaseInterface, InstanceMapData>();\nconst nextSiblingMap = new WeakMap<DefaultWidgetBaseInterface, InternalDNode[]>();\nconst projectorStateMap = new WeakMap<DefaultWidgetBaseInterface, ProjectorState>();\n\nfunction same(dnode1: InternalDNode, dnode2: InternalDNode) {\n\tif (isVNode(dnode1) && isVNode(dnode2)) {\n\t\tif (isDomVNode(dnode1) || isDomVNode(dnode2)) {\n\t\t\tif (dnode1.domNode !== dnode2.domNode) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tif (dnode1.tag !== dnode2.tag) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.properties.key !== dnode2.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t} else if (isWNode(dnode1) && isWNode(dnode2)) {\n\t\tif (dnode1.instance === undefined && typeof dnode2.widgetConstructor === 'string') {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.widgetConstructor !== dnode2.widgetConstructor) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.properties.key !== dnode2.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nconst missingTransition = function() {\n\tthrow new Error('Provide a transitions object to the projectionOptions to do animations');\n};\n\nfunction getProjectionOptions(\n\tprojectorOptions: Partial<ProjectionOptions>,\n\tprojectorInstance: DefaultWidgetBaseInterface\n): ProjectionOptions {\n\tconst defaults: Partial<ProjectionOptions> = {\n\t\tnamespace: undefined,\n\t\tstyleApplyer: function(domNode: HTMLElement, styleName: string, value: string) {\n\t\t\t(domNode.style as any)[styleName] = value;\n\t\t},\n\t\ttransitions: {\n\t\t\tenter: missingTransition,\n\t\t\texit: missingTransition\n\t\t},\n\t\tdepth: 0,\n\t\tmerge: false,\n\t\tsync: false,\n\t\tprojectorInstance\n\t};\n\treturn { ...defaults, ...projectorOptions } as ProjectionOptions;\n}\n\nfunction checkStyleValue(styleValue: Object) {\n\tif (typeof styleValue !== 'string') {\n\t\tthrow new Error('Style values must be strings');\n\t}\n}\n\nfunction updateEvent(\n\tdomNode: Node,\n\teventName: string,\n\tcurrentValue: Function,\n\tprojectionOptions: ProjectionOptions,\n\tbind: any,\n\tpreviousValue?: Function\n) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tconst eventMap = projectorState.nodeMap.get(domNode) || new WeakMap();\n\n\tif (previousValue) {\n\t\tconst previousEvent = eventMap.get(previousValue);\n\t\tdomNode.removeEventListener(eventName, previousEvent);\n\t}\n\n\tlet callback = currentValue.bind(bind);\n\n\tif (eventName === 'input') {\n\t\tcallback = function(this: any, evt: Event) {\n\t\t\tcurrentValue.call(this, evt);\n\t\t\t(evt.target as any)['oninput-value'] = (evt.target as HTMLInputElement).value;\n\t\t}.bind(bind);\n\t}\n\n\tdomNode.addEventListener(eventName, callback);\n\teventMap.set(currentValue, callback);\n\tprojectorState.nodeMap.set(domNode, eventMap);\n}\n\nfunction addClasses(domNode: Element, classes: SupportedClassName) {\n\tif (classes) {\n\t\tconst classNames = classes.split(' ');\n\t\tfor (let i = 0; i < classNames.length; i++) {\n\t\t\tdomNode.classList.add(classNames[i]);\n\t\t}\n\t}\n}\n\nfunction removeClasses(domNode: Element, classes: SupportedClassName) {\n\tif (classes) {\n\t\tconst classNames = classes.split(' ');\n\t\tfor (let i = 0; i < classNames.length; i++) {\n\t\t\tdomNode.classList.remove(classNames[i]);\n\t\t}\n\t}\n}\n\nfunction buildPreviousProperties(domNode: any, previous: InternalVNode, current: InternalVNode) {\n\tconst { diffType, properties, attributes } = current;\n\tif (!diffType || diffType === 'vdom') {\n\t\treturn { properties: previous.properties, attributes: previous.attributes, events: previous.events };\n\t} else if (diffType === 'none') {\n\t\treturn { properties: {}, attributes: previous.attributes ? {} : undefined, events: previous.events };\n\t}\n\tlet newProperties: any = {\n\t\tproperties: {}\n\t};\n\tif (attributes) {\n\t\tnewProperties.attributes = {};\n\t\tnewProperties.events = previous.events;\n\t\tObject.keys(properties).forEach((propName) => {\n\t\t\tnewProperties.properties[propName] = domNode[propName];\n\t\t});\n\t\tObject.keys(attributes).forEach((attrName) => {\n\t\t\tnewProperties.attributes[attrName] = domNode.getAttribute(attrName);\n\t\t});\n\t\treturn newProperties;\n\t}\n\tnewProperties.properties = Object.keys(properties).reduce(\n\t\t(props, property) => {\n\t\t\tprops[property] = domNode.getAttribute(property) || domNode[property];\n\t\t\treturn props;\n\t\t},\n\t\t{} as any\n\t);\n\treturn newProperties;\n}\n\nfunction nodeOperation(\n\tpropName: string,\n\tpropValue: any,\n\tpreviousValue: any,\n\tdomNode: Element,\n\tprojectionOptions: ProjectionOptions\n): void {\n\tlet result;\n\tif (typeof propValue === 'function') {\n\t\tresult = propValue();\n\t} else {\n\t\tresult = propValue && !previousValue;\n\t}\n\tif (result === true) {\n\t\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\t\tprojectorState.deferredRenderCallbacks.push(() => {\n\t\t\t(domNode as any)[propName]();\n\t\t});\n\t}\n}\n\nfunction removeOrphanedEvents(\n\tdomNode: Element,\n\tpreviousProperties: VNodeProperties,\n\tproperties: VNodeProperties,\n\tprojectionOptions: ProjectionOptions,\n\tonlyEvents: boolean = false\n) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tconst eventMap = projectorState.nodeMap.get(domNode);\n\tif (eventMap) {\n\t\tObject.keys(previousProperties).forEach((propName) => {\n\t\t\tconst isEvent = propName.substr(0, 2) === 'on' || onlyEvents;\n\t\t\tconst eventName = onlyEvents ? propName : propName.substr(2);\n\t\t\tif (isEvent && !properties[propName]) {\n\t\t\t\tconst eventCallback = eventMap.get(previousProperties[propName]);\n\t\t\t\tif (eventCallback) {\n\t\t\t\t\tdomNode.removeEventListener(eventName, eventCallback);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction updateAttribute(domNode: Element, attrName: string, attrValue: string, projectionOptions: ProjectionOptions) {\n\tif (projectionOptions.namespace === NAMESPACE_SVG && attrName === 'href') {\n\t\tdomNode.setAttributeNS(NAMESPACE_XLINK, attrName, attrValue);\n\t} else if ((attrName === 'role' && attrValue === '') || attrValue === undefined) {\n\t\tdomNode.removeAttribute(attrName);\n\t} else {\n\t\tdomNode.setAttribute(attrName, attrValue);\n\t}\n}\n\nfunction updateAttributes(\n\tdomNode: Element,\n\tpreviousAttributes: { [index: string]: string },\n\tattributes: { [index: string]: string },\n\tprojectionOptions: ProjectionOptions\n) {\n\tconst attrNames = Object.keys(attributes);\n\tconst attrCount = attrNames.length;\n\tfor (let i = 0; i < attrCount; i++) {\n\t\tconst attrName = attrNames[i];\n\t\tconst attrValue = attributes[attrName];\n\t\tconst previousAttrValue = previousAttributes[attrName];\n\t\tif (attrValue !== previousAttrValue) {\n\t\t\tupdateAttribute(domNode, attrName, attrValue, projectionOptions);\n\t\t}\n\t}\n}\n\nfunction updateProperties(\n\tdomNode: Element,\n\tpreviousProperties: VNodeProperties,\n\tproperties: VNodeProperties,\n\tprojectionOptions: ProjectionOptions,\n\tincludesEventsAndAttributes = true\n) {\n\tlet propertiesUpdated = false;\n\tconst propNames = Object.keys(properties);\n\tconst propCount = propNames.length;\n\tif (propNames.indexOf('classes') === -1 && previousProperties.classes) {\n\t\tif (Array.isArray(previousProperties.classes)) {\n\t\t\tfor (let i = 0; i < previousProperties.classes.length; i++) {\n\t\t\t\tremoveClasses(domNode, previousProperties.classes[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tremoveClasses(domNode, previousProperties.classes);\n\t\t}\n\t}\n\n\tincludesEventsAndAttributes && removeOrphanedEvents(domNode, previousProperties, properties, projectionOptions);\n\n\tfor (let i = 0; i < propCount; i++) {\n\t\tconst propName = propNames[i];\n\t\tlet propValue = properties[propName];\n\t\tconst previousValue = previousProperties![propName];\n\t\tif (propName === 'classes') {\n\t\t\tconst previousClasses = Array.isArray(previousValue) ? previousValue : [previousValue];\n\t\t\tconst currentClasses = Array.isArray(propValue) ? propValue : [propValue];\n\t\t\tif (previousClasses && previousClasses.length > 0) {\n\t\t\t\tif (!propValue || propValue.length === 0) {\n\t\t\t\t\tfor (let i = 0; i < previousClasses.length; i++) {\n\t\t\t\t\t\tremoveClasses(domNode, previousClasses[i]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst newClasses: (null | undefined | string)[] = [...currentClasses];\n\t\t\t\t\tfor (let i = 0; i < previousClasses.length; i++) {\n\t\t\t\t\t\tconst previousClassName = previousClasses[i];\n\t\t\t\t\t\tif (previousClassName) {\n\t\t\t\t\t\t\tconst classIndex = newClasses.indexOf(previousClassName);\n\t\t\t\t\t\t\tif (classIndex === -1) {\n\t\t\t\t\t\t\t\tremoveClasses(domNode, previousClassName);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnewClasses.splice(classIndex, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = 0; i < newClasses.length; i++) {\n\t\t\t\t\t\taddClasses(domNode, newClasses[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < currentClasses.length; i++) {\n\t\t\t\t\taddClasses(domNode, currentClasses[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (nodeOperations.indexOf(propName) !== -1) {\n\t\t\tnodeOperation(propName, propValue, previousValue, domNode, projectionOptions);\n\t\t} else if (propName === 'styles') {\n\t\t\tconst styleNames = Object.keys(propValue);\n\t\t\tconst styleCount = styleNames.length;\n\t\t\tfor (let j = 0; j < styleCount; j++) {\n\t\t\t\tconst styleName = styleNames[j];\n\t\t\t\tconst newStyleValue = propValue[styleName];\n\t\t\t\tconst oldStyleValue = previousValue && previousValue[styleName];\n\t\t\t\tif (newStyleValue === oldStyleValue) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tpropertiesUpdated = true;\n\t\t\t\tif (newStyleValue) {\n\t\t\t\t\tcheckStyleValue(newStyleValue);\n\t\t\t\t\tprojectionOptions.styleApplyer!(domNode as HTMLElement, styleName, newStyleValue);\n\t\t\t\t} else {\n\t\t\t\t\tprojectionOptions.styleApplyer!(domNode as HTMLElement, styleName, '');\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!propValue && typeof previousValue === 'string') {\n\t\t\t\tpropValue = '';\n\t\t\t}\n\t\t\tif (propName === 'value') {\n\t\t\t\tconst domValue = (domNode as any)[propName];\n\t\t\t\tif (\n\t\t\t\t\tdomValue !== propValue &&\n\t\t\t\t\t((domNode as any)['oninput-value']\n\t\t\t\t\t\t? domValue === (domNode as any)['oninput-value']\n\t\t\t\t\t\t: propValue !== previousValue)\n\t\t\t\t) {\n\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t(domNode as any)['oninput-value'] = undefined;\n\t\t\t\t}\n\t\t\t\tif (propValue !== previousValue) {\n\t\t\t\t\tpropertiesUpdated = true;\n\t\t\t\t}\n\t\t\t} else if (propName !== 'key' && propValue !== previousValue) {\n\t\t\t\tconst type = typeof propValue;\n\t\t\t\tif (type === 'function' && propName.lastIndexOf('on', 0) === 0 && includesEventsAndAttributes) {\n\t\t\t\t\tupdateEvent(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tpropName.substr(2),\n\t\t\t\t\t\tpropValue,\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tproperties.bind,\n\t\t\t\t\t\tpreviousValue\n\t\t\t\t\t);\n\t\t\t\t} else if (type === 'string' && propName !== 'innerHTML' && includesEventsAndAttributes) {\n\t\t\t\t\tupdateAttribute(domNode, propName, propValue, projectionOptions);\n\t\t\t\t} else if (propName === 'scrollLeft' || propName === 'scrollTop') {\n\t\t\t\t\tif ((domNode as any)[propName] !== propValue) {\n\t\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t}\n\t\t\t\tpropertiesUpdated = true;\n\t\t\t}\n\t\t}\n\t}\n\treturn propertiesUpdated;\n}\n\nfunction findIndexOfChild(children: InternalDNode[], sameAs: InternalDNode, start: number) {\n\tfor (let i = start; i < children.length; i++) {\n\t\tif (same(children[i], sameAs)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\nexport function toParentVNode(domNode: Element): InternalVNode {\n\treturn {\n\t\ttag: '',\n\t\tproperties: {},\n\t\tchildren: undefined,\n\t\tdomNode,\n\t\ttype: VNODE\n\t};\n}\n\nexport function toTextVNode(data: any): InternalVNode {\n\treturn {\n\t\ttag: '',\n\t\tproperties: {},\n\t\tchildren: undefined,\n\t\ttext: `${data}`,\n\t\tdomNode: undefined,\n\t\ttype: VNODE\n\t};\n}\n\nfunction toInternalWNode(instance: DefaultWidgetBaseInterface, instanceData: WidgetData): InternalWNode {\n\treturn {\n\t\tinstance,\n\t\trendered: [],\n\t\tcoreProperties: instanceData.coreProperties,\n\t\tchildren: instance.children as any,\n\t\twidgetConstructor: instance.constructor as any,\n\t\tproperties: instanceData.inputProperties,\n\t\ttype: WNODE\n\t};\n}\n\nexport function filterAndDecorateChildren(\n\tchildren: undefined | DNode | DNode[],\n\tinstance: DefaultWidgetBaseInterface\n): InternalDNode[] {\n\tif (children === undefined) {\n\t\treturn emptyArray;\n\t}\n\tchildren = Array.isArray(children) ? children : [children];\n\n\tfor (let i = 0; i < children.length; ) {\n\t\tconst child = children[i] as InternalDNode;\n\t\tif (child === undefined || child === null) {\n\t\t\tchildren.splice(i, 1);\n\t\t\tcontinue;\n\t\t} else if (typeof child === 'string') {\n\t\t\tchildren[i] = toTextVNode(child);\n\t\t} else {\n\t\t\tif (isVNode(child)) {\n\t\t\t\tif (child.properties.bind === undefined) {\n\t\t\t\t\t(child.properties as any).bind = instance;\n\t\t\t\t\tif (child.children && child.children.length > 0) {\n\t\t\t\t\t\tfilterAndDecorateChildren(child.children, instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!child.coreProperties) {\n\t\t\t\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\t\t\t\tchild.coreProperties = {\n\t\t\t\t\t\tbind: instance,\n\t\t\t\t\t\tbaseRegistry: instanceData.coreProperties.baseRegistry\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (child.children && child.children.length > 0) {\n\t\t\t\t\tfilterAndDecorateChildren(child.children, instance);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ti++;\n\t}\n\treturn children as InternalDNode[];\n}\n\nfunction nodeAdded(dnode: InternalDNode, transitions: TransitionStrategy) {\n\tif (isVNode(dnode) && dnode.properties) {\n\t\tconst enterAnimation = dnode.properties.enterAnimation;\n\t\tif (enterAnimation) {\n\t\t\tif (typeof enterAnimation === 'function') {\n\t\t\t\tenterAnimation(dnode.domNode as Element, dnode.properties);\n\t\t\t} else {\n\t\t\t\ttransitions.enter(dnode.domNode as Element, dnode.properties, enterAnimation as string);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction nodeToRemove(dnode: InternalDNode, transitions: TransitionStrategy, projectionOptions: ProjectionOptions) {\n\tif (isWNode(dnode)) {\n\t\tconst item = instanceMap.get(dnode.instance);\n\t\tconst rendered = (item ? item.dnode.rendered : dnode.rendered) || emptyArray;\n\t\tif (dnode.instance) {\n\t\t\tconst instanceData = widgetInstanceMap.get(dnode.instance)!;\n\t\t\tinstanceData.onDetach();\n\t\t\tinstanceMap.delete(dnode.instance);\n\t\t}\n\t\tfor (let i = 0; i < rendered.length; i++) {\n\t\t\tnodeToRemove(rendered[i], transitions, projectionOptions);\n\t\t}\n\t} else {\n\t\tconst domNode = dnode.domNode;\n\t\tconst properties = dnode.properties;\n\t\tif (dnode.children && dnode.children.length > 0) {\n\t\t\tfor (let i = 0; i < dnode.children.length; i++) {\n\t\t\t\tnodeToRemove(dnode.children[i], transitions, projectionOptions);\n\t\t\t}\n\t\t}\n\t\tconst exitAnimation = properties.exitAnimation;\n\t\tif (properties && exitAnimation) {\n\t\t\t(domNode as HTMLElement).style.pointerEvents = 'none';\n\t\t\tconst removeDomNode = function() {\n\t\t\t\tdomNode && domNode.parentNode && domNode.parentNode.removeChild(domNode);\n\t\t\t\tdnode.domNode = undefined;\n\t\t\t};\n\t\t\tif (typeof exitAnimation === 'function') {\n\t\t\t\texitAnimation(domNode as Element, removeDomNode, properties);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\ttransitions.exit(dnode.domNode as Element, properties, exitAnimation as string, removeDomNode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tdomNode && domNode.parentNode && domNode.parentNode.removeChild(domNode);\n\t\tdnode.domNode = undefined;\n\t}\n}\n\nfunction checkDistinguishable(\n\tchildNodes: InternalDNode[],\n\tindexToCheck: number,\n\tparentInstance: DefaultWidgetBaseInterface\n) {\n\tconst childNode = childNodes[indexToCheck];\n\tif (isVNode(childNode) && !childNode.tag) {\n\t\treturn; // Text nodes need not be distinguishable\n\t}\n\tconst { key } = childNode.properties;\n\n\tif (key === undefined || key === null) {\n\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\tif (i !== indexToCheck) {\n\t\t\t\tconst node = childNodes[i];\n\t\t\t\tif (same(node, childNode)) {\n\t\t\t\t\tlet nodeIdentifier: string;\n\t\t\t\t\tconst parentName = (parentInstance as any).constructor.name || 'unknown';\n\t\t\t\t\tif (isWNode(childNode)) {\n\t\t\t\t\t\tnodeIdentifier = (childNode.widgetConstructor as any).name || 'unknown';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnodeIdentifier = childNode.tag;\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`A widget (${parentName}) has had a child addded or removed, but they were not able to uniquely identified. It is recommended to provide a unique 'key' property when using the same widget or element (${nodeIdentifier}) multiple times as siblings`\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateChildren(\n\tparentVNode: InternalVNode,\n\tsiblings: InternalDNode[],\n\toldChildren: InternalDNode[],\n\tnewChildren: InternalDNode[],\n\tparentInstance: DefaultWidgetBaseInterface,\n\tprojectionOptions: ProjectionOptions\n) {\n\toldChildren = oldChildren || emptyArray;\n\tnewChildren = newChildren;\n\tconst oldChildrenLength = oldChildren.length;\n\tconst newChildrenLength = newChildren.length;\n\tconst transitions = projectionOptions.transitions!;\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tprojectionOptions = { ...projectionOptions, depth: projectionOptions.depth + 1 };\n\tlet oldIndex = 0;\n\tlet newIndex = 0;\n\tlet i: number;\n\tlet textUpdated = false;\n\twhile (newIndex < newChildrenLength) {\n\t\tlet oldChild = oldIndex < oldChildrenLength ? oldChildren[oldIndex] : undefined;\n\t\tconst newChild = newChildren[newIndex];\n\t\tif (isVNode(newChild) && typeof newChild.deferredPropertiesCallback === 'function') {\n\t\t\tnewChild.inserted = isVNode(oldChild) && oldChild.inserted;\n\t\t\taddDeferredProperties(newChild, projectionOptions);\n\t\t}\n\t\tif (oldChild !== undefined && same(oldChild, newChild)) {\n\t\t\toldIndex++;\n\t\t\tnewIndex++;\n\t\t\ttextUpdated =\n\t\t\t\tupdateDom(\n\t\t\t\t\toldChild,\n\t\t\t\t\tnewChild,\n\t\t\t\t\tprojectionOptions,\n\t\t\t\t\tparentVNode,\n\t\t\t\t\tparentInstance,\n\t\t\t\t\toldChildren.slice(oldIndex),\n\t\t\t\t\tnewChildren.slice(newIndex)\n\t\t\t\t) || textUpdated;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst findOldIndex = findIndexOfChild(oldChildren, newChild, oldIndex + 1);\n\t\tconst addChild = () => {\n\t\t\tlet insertBeforeDomNode: Node | undefined = undefined;\n\t\t\tlet childrenArray = oldChildren;\n\t\t\tlet nextIndex = oldIndex + 1;\n\t\t\tlet child: InternalDNode = oldChildren[oldIndex];\n\t\t\tif (!child) {\n\t\t\t\tchild = siblings[0];\n\t\t\t\tnextIndex = 1;\n\t\t\t\tchildrenArray = siblings;\n\t\t\t}\n\t\t\tif (child) {\n\t\t\t\tlet insertBeforeChildren = [child];\n\t\t\t\twhile (insertBeforeChildren.length) {\n\t\t\t\t\tconst insertBefore = insertBeforeChildren.shift()!;\n\t\t\t\t\tif (isWNode(insertBefore)) {\n\t\t\t\t\t\tconst item = instanceMap.get(insertBefore.instance);\n\t\t\t\t\t\tif (item && item.dnode.rendered) {\n\t\t\t\t\t\t\tinsertBeforeChildren.push(...item.dnode.rendered);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (insertBefore.domNode) {\n\t\t\t\t\t\t\tif (insertBefore.domNode.parentElement !== parentVNode.domNode) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinsertBeforeDomNode = insertBefore.domNode;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (insertBeforeChildren.length === 0 && childrenArray[nextIndex]) {\n\t\t\t\t\t\tinsertBeforeChildren.push(childrenArray[nextIndex]);\n\t\t\t\t\t\tnextIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcreateDom(\n\t\t\t\tnewChild,\n\t\t\t\tparentVNode,\n\t\t\t\tnewChildren.slice(newIndex + 1),\n\t\t\t\tinsertBeforeDomNode,\n\t\t\t\tprojectionOptions,\n\t\t\t\tparentInstance\n\t\t\t);\n\t\t\tnodeAdded(newChild, transitions);\n\t\t\tconst indexToCheck = newIndex;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(newChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t};\n\n\t\tif (!oldChild || findOldIndex === -1) {\n\t\t\taddChild();\n\t\t\tnewIndex++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst removeChild = () => {\n\t\t\tconst indexToCheck = oldIndex;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(oldChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t\tif (isWNode(oldChild)) {\n\t\t\t\tconst item = instanceMap.get(oldChild.instance);\n\t\t\t\tif (item) {\n\t\t\t\t\toldChild = item.dnode;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnodeToRemove(oldChild!, transitions, projectionOptions);\n\t\t};\n\t\tconst findNewIndex = findIndexOfChild(newChildren, oldChild, newIndex + 1);\n\n\t\tif (findNewIndex === -1) {\n\t\t\tremoveChild();\n\t\t\toldIndex++;\n\t\t\tcontinue;\n\t\t}\n\n\t\taddChild();\n\t\tremoveChild();\n\t\toldIndex++;\n\t\tnewIndex++;\n\t}\n\tif (oldChildrenLength > oldIndex) {\n\t\t// Remove child fragments\n\t\tfor (i = oldIndex; i < oldChildrenLength; i++) {\n\t\t\tconst indexToCheck = i;\n\t\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\t\tcheckDistinguishable(oldChildren, indexToCheck, parentInstance);\n\t\t\t});\n\t\t\tlet childToRemove = oldChildren[i];\n\t\t\tif (isWNode(childToRemove)) {\n\t\t\t\tconst item = instanceMap.get(childToRemove.instance);\n\t\t\t\tif (item) {\n\t\t\t\t\tchildToRemove = item.dnode;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnodeToRemove(childToRemove, transitions, projectionOptions);\n\t\t}\n\t}\n\treturn textUpdated;\n}\n\nfunction addChildren(\n\tparentVNode: InternalVNode,\n\tchildren: InternalDNode[] | undefined,\n\tprojectionOptions: ProjectionOptions,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tinsertBefore: Node | undefined = undefined,\n\tchildNodes?: (Element | Text)[]\n) {\n\tif (children === undefined) {\n\t\treturn;\n\t}\n\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectorState.merge && childNodes === undefined) {\n\t\tchildNodes = arrayFrom(parentVNode.domNode!.childNodes) as (Element | Text)[];\n\t}\n\tconst transitions = projectionOptions.transitions!;\n\tprojectionOptions = { ...projectionOptions, depth: projectionOptions.depth + 1 };\n\n\tfor (let i = 0; i < children.length; i++) {\n\t\tconst child = children[i];\n\t\tconst nextSiblings = children.slice(i + 1);\n\n\t\tif (isVNode(child)) {\n\t\t\tif (projectorState.merge && childNodes) {\n\t\t\t\tlet domElement: Element | undefined = undefined;\n\t\t\t\twhile (child.domNode === undefined && childNodes.length > 0) {\n\t\t\t\t\tdomElement = childNodes.shift() as Element;\n\t\t\t\t\tif (domElement && domElement.tagName === (child.tag.toUpperCase() || undefined)) {\n\t\t\t\t\t\tchild.domNode = domElement;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcreateDom(child, parentVNode, nextSiblings, insertBefore, projectionOptions, parentInstance);\n\t\t} else {\n\t\t\tcreateDom(child, parentVNode, nextSiblings, insertBefore, projectionOptions, parentInstance, childNodes);\n\t\t}\n\t\tnodeAdded(child, transitions);\n\t}\n}\n\nfunction initPropertiesAndChildren(\n\tdomNode: Element,\n\tdnode: InternalVNode,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tprojectionOptions: ProjectionOptions\n) {\n\taddChildren(dnode, dnode.children, projectionOptions, parentInstance, undefined);\n\tif (typeof dnode.deferredPropertiesCallback === 'function' && dnode.inserted === undefined) {\n\t\taddDeferredProperties(dnode, projectionOptions);\n\t}\n\n\tif (dnode.attributes && dnode.events) {\n\t\tupdateAttributes(domNode, {}, dnode.attributes, projectionOptions);\n\t\tupdateProperties(domNode, {}, dnode.properties, projectionOptions, false);\n\t\tremoveOrphanedEvents(domNode, {}, dnode.events, projectionOptions, true);\n\t\tconst events = dnode.events;\n\t\tObject.keys(events).forEach((event) => {\n\t\t\tupdateEvent(domNode, event, events[event], projectionOptions, dnode.properties.bind);\n\t\t});\n\t} else {\n\t\tupdateProperties(domNode, {}, dnode.properties, projectionOptions);\n\t}\n\tif (dnode.properties.key !== null && dnode.properties.key !== undefined) {\n\t\tconst instanceData = widgetInstanceMap.get(parentInstance)!;\n\t\tinstanceData.nodeHandler.add(domNode as HTMLElement, `${dnode.properties.key}`);\n\t}\n\tdnode.inserted = true;\n}\n\nfunction createDom(\n\tdnode: InternalDNode,\n\tparentVNode: InternalVNode,\n\tnextSiblings: InternalDNode[],\n\tinsertBefore: Node | undefined,\n\tprojectionOptions: ProjectionOptions,\n\tparentInstance: DefaultWidgetBaseInterface,\n\tchildNodes?: (Element | Text)[]\n) {\n\tlet domNode: Element | Text | undefined;\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (isWNode(dnode)) {\n\t\tlet { widgetConstructor } = dnode;\n\t\tconst parentInstanceData = widgetInstanceMap.get(parentInstance)!;\n\t\tif (!isWidgetBaseConstructor<DefaultWidgetBaseInterface>(widgetConstructor)) {\n\t\t\tconst item = parentInstanceData.registry().get<DefaultWidgetBaseInterface>(widgetConstructor);\n\t\t\tif (item === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\twidgetConstructor = item;\n\t\t}\n\t\tconst instance = new widgetConstructor();\n\t\tdnode.instance = instance;\n\t\tnextSiblingMap.set(instance, nextSiblings);\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tinstanceData.invalidate = () => {\n\t\t\tinstanceData.dirty = true;\n\t\t\tif (instanceData.rendering === false) {\n\t\t\t\tprojectorState.renderQueue.push({ instance, depth: projectionOptions.depth });\n\t\t\t\tscheduleRender(projectionOptions);\n\t\t\t}\n\t\t};\n\t\tinstanceData.rendering = true;\n\t\tinstance.__setCoreProperties__(dnode.coreProperties);\n\t\tinstance.__setChildren__(dnode.children);\n\t\tinstance.__setProperties__(dnode.properties);\n\t\tconst rendered = instance.__render__();\n\t\tinstanceData.rendering = false;\n\t\tif (rendered) {\n\t\t\tconst filteredRendered = filterAndDecorateChildren(rendered, instance);\n\t\t\tdnode.rendered = filteredRendered;\n\t\t\taddChildren(parentVNode, filteredRendered, projectionOptions, instance, insertBefore, childNodes);\n\t\t}\n\t\tinstanceMap.set(instance, { dnode, parentVNode });\n\t\tinstanceData.nodeHandler.addRoot();\n\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\tinstanceData.onAttach();\n\t\t});\n\t} else {\n\t\tif (projectorState.merge && projectorState.mergeElement !== undefined) {\n\t\t\tdomNode = dnode.domNode = projectionOptions.mergeElement;\n\t\t\tprojectorState.mergeElement = undefined;\n\t\t\tinitPropertiesAndChildren(domNode!, dnode, parentInstance, projectionOptions);\n\t\t\treturn;\n\t\t}\n\t\tconst doc = parentVNode.domNode!.ownerDocument;\n\t\tif (!dnode.tag && typeof dnode.text === 'string') {\n\t\t\tif (dnode.domNode !== undefined && parentVNode.domNode) {\n\t\t\t\tconst newDomNode = dnode.domNode.ownerDocument.createTextNode(dnode.text!);\n\t\t\t\tif (parentVNode.domNode === dnode.domNode.parentNode) {\n\t\t\t\t\tparentVNode.domNode.replaceChild(newDomNode, dnode.domNode);\n\t\t\t\t} else {\n\t\t\t\t\tparentVNode.domNode.appendChild(newDomNode);\n\t\t\t\t\tdnode.domNode.parentNode && dnode.domNode.parentNode.removeChild(dnode.domNode);\n\t\t\t\t}\n\t\t\t\tdnode.domNode = newDomNode;\n\t\t\t} else {\n\t\t\t\tdomNode = dnode.domNode = doc.createTextNode(dnode.text!);\n\t\t\t\tif (insertBefore !== undefined) {\n\t\t\t\t\tparentVNode.domNode!.insertBefore(domNode, insertBefore);\n\t\t\t\t} else {\n\t\t\t\t\tparentVNode.domNode!.appendChild(domNode);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (dnode.domNode === undefined) {\n\t\t\t\tif (dnode.tag === 'svg') {\n\t\t\t\t\tprojectionOptions = { ...projectionOptions, ...{ namespace: NAMESPACE_SVG } };\n\t\t\t\t}\n\t\t\t\tif (projectionOptions.namespace !== undefined) {\n\t\t\t\t\tdomNode = dnode.domNode = doc.createElementNS(projectionOptions.namespace, dnode.tag);\n\t\t\t\t} else {\n\t\t\t\t\tdomNode = dnode.domNode = dnode.domNode || doc.createElement(dnode.tag);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdomNode = dnode.domNode;\n\t\t\t}\n\t\t\tinitPropertiesAndChildren(domNode! as Element, dnode, parentInstance, projectionOptions);\n\t\t\tif (insertBefore !== undefined) {\n\t\t\t\tparentVNode.domNode!.insertBefore(domNode, insertBefore);\n\t\t\t} else if (domNode!.parentNode !== parentVNode.domNode!) {\n\t\t\t\tparentVNode.domNode!.appendChild(domNode);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateDom(\n\tprevious: any,\n\tdnode: InternalDNode,\n\tprojectionOptions: ProjectionOptions,\n\tparentVNode: InternalVNode,\n\tparentInstance: DefaultWidgetBaseInterface,\n\toldNextSiblings: InternalDNode[],\n\tnextSiblings: InternalDNode[]\n) {\n\tif (isWNode(dnode)) {\n\t\tconst { instance } = previous;\n\t\tconst { parentVNode, dnode: node } = instanceMap.get(instance)!;\n\t\tconst previousRendered = node ? node.rendered : previous.rendered;\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tinstanceData.rendering = true;\n\t\tinstance.__setCoreProperties__(dnode.coreProperties);\n\t\tinstance.__setChildren__(dnode.children);\n\t\tinstance.__setProperties__(dnode.properties);\n\t\tnextSiblingMap.set(instance, nextSiblings);\n\t\tdnode.instance = instance;\n\t\tif (instanceData.dirty === true) {\n\t\t\tconst rendered = instance.__render__();\n\t\t\tinstanceData.rendering = false;\n\t\t\tdnode.rendered = filterAndDecorateChildren(rendered, instance);\n\t\t\tupdateChildren(parentVNode, oldNextSiblings, previousRendered, dnode.rendered, instance, projectionOptions);\n\t\t} else {\n\t\t\tinstanceData.rendering = false;\n\t\t\tdnode.rendered = previousRendered;\n\t\t}\n\t\tinstanceMap.set(instance, { dnode, parentVNode });\n\t\tinstanceData.nodeHandler.addRoot();\n\t} else {\n\t\tif (previous === dnode) {\n\t\t\treturn false;\n\t\t}\n\t\tconst domNode = (dnode.domNode = previous.domNode);\n\t\tlet textUpdated = false;\n\t\tlet updated = false;\n\t\tif (!dnode.tag && typeof dnode.text === 'string') {\n\t\t\tif (dnode.text !== previous.text) {\n\t\t\t\tconst newDomNode = domNode.ownerDocument.createTextNode(dnode.text!);\n\t\t\t\tdomNode.parentNode!.replaceChild(newDomNode, domNode);\n\t\t\t\tdnode.domNode = newDomNode;\n\t\t\t\ttextUpdated = true;\n\t\t\t\treturn textUpdated;\n\t\t\t}\n\t\t} else {\n\t\t\tif (dnode.tag && dnode.tag.lastIndexOf('svg', 0) === 0) {\n\t\t\t\tprojectionOptions = { ...projectionOptions, ...{ namespace: NAMESPACE_SVG } };\n\t\t\t}\n\t\t\tif (previous.children !== dnode.children) {\n\t\t\t\tconst children = filterAndDecorateChildren(dnode.children, parentInstance);\n\t\t\t\tdnode.children = children;\n\t\t\t\tupdated =\n\t\t\t\t\tupdateChildren(\n\t\t\t\t\t\tdnode,\n\t\t\t\t\t\toldNextSiblings,\n\t\t\t\t\t\tprevious.children,\n\t\t\t\t\t\tchildren,\n\t\t\t\t\t\tparentInstance,\n\t\t\t\t\t\tprojectionOptions\n\t\t\t\t\t) || updated;\n\t\t\t}\n\n\t\t\tconst previousProperties = buildPreviousProperties(domNode, previous, dnode);\n\t\t\tif (dnode.attributes && dnode.events) {\n\t\t\t\tupdateAttributes(domNode, previousProperties.attributes, dnode.attributes, projectionOptions);\n\t\t\t\tupdated =\n\t\t\t\t\tupdateProperties(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tpreviousProperties.properties,\n\t\t\t\t\t\tdnode.properties,\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t) || updated;\n\t\t\t\tremoveOrphanedEvents(domNode, previousProperties.events, dnode.events, projectionOptions, true);\n\t\t\t\tconst events = dnode.events;\n\t\t\t\tObject.keys(events).forEach((event) => {\n\t\t\t\t\tupdateEvent(\n\t\t\t\t\t\tdomNode,\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tevents[event],\n\t\t\t\t\t\tprojectionOptions,\n\t\t\t\t\t\tdnode.properties.bind,\n\t\t\t\t\t\tpreviousProperties.events[event]\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tupdated =\n\t\t\t\t\tupdateProperties(domNode, previousProperties.properties, dnode.properties, projectionOptions) ||\n\t\t\t\t\tupdated;\n\t\t\t}\n\n\t\t\tif (dnode.properties.key !== null && dnode.properties.key !== undefined) {\n\t\t\t\tconst instanceData = widgetInstanceMap.get(parentInstance)!;\n\t\t\t\tinstanceData.nodeHandler.add(domNode, `${dnode.properties.key}`);\n\t\t\t}\n\t\t}\n\t\tif (updated && dnode.properties && dnode.properties.updateAnimation) {\n\t\t\tdnode.properties.updateAnimation(domNode as Element, dnode.properties, previous.properties);\n\t\t}\n\t}\n}\n\nfunction addDeferredProperties(vnode: InternalVNode, projectionOptions: ProjectionOptions) {\n\t// transfer any properties that have been passed - as these must be decorated properties\n\tvnode.decoratedDeferredProperties = vnode.properties;\n\tconst properties = vnode.deferredPropertiesCallback!(!!vnode.inserted);\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tvnode.properties = { ...properties, ...vnode.decoratedDeferredProperties };\n\tprojectorState.deferredRenderCallbacks.push(() => {\n\t\tconst properties = {\n\t\t\t...vnode.deferredPropertiesCallback!(!!vnode.inserted),\n\t\t\t...vnode.decoratedDeferredProperties\n\t\t};\n\t\tupdateProperties(vnode.domNode! as Element, vnode.properties, properties, projectionOptions);\n\t\tvnode.properties = properties;\n\t});\n}\n\nfunction runDeferredRenderCallbacks(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectorState.deferredRenderCallbacks.length) {\n\t\tif (projectionOptions.sync) {\n\t\t\twhile (projectorState.deferredRenderCallbacks.length) {\n\t\t\t\tconst callback = projectorState.deferredRenderCallbacks.shift();\n\t\t\t\tcallback && callback();\n\t\t\t}\n\t\t} else {\n\t\t\tglobal.requestAnimationFrame(() => {\n\t\t\t\twhile (projectorState.deferredRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.deferredRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction runAfterRenderCallbacks(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectionOptions.sync) {\n\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\tcallback && callback();\n\t\t}\n\t} else {\n\t\tif (global.requestIdleCallback) {\n\t\t\tglobal.requestIdleCallback(() => {\n\t\t\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\twhile (projectorState.afterRenderCallbacks.length) {\n\t\t\t\t\tconst callback = projectorState.afterRenderCallbacks.shift();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction scheduleRender(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tif (projectionOptions.sync) {\n\t\trender(projectionOptions);\n\t} else if (projectorState.renderScheduled === undefined) {\n\t\tprojectorState.renderScheduled = global.requestAnimationFrame(() => {\n\t\t\trender(projectionOptions);\n\t\t});\n\t}\n}\n\nfunction render(projectionOptions: ProjectionOptions) {\n\tconst projectorState = projectorStateMap.get(projectionOptions.projectorInstance)!;\n\tprojectorState.renderScheduled = undefined;\n\tconst renderQueue = projectorState.renderQueue;\n\tconst renders = [...renderQueue];\n\tprojectorState.renderQueue = [];\n\trenders.sort((a, b) => a.depth - b.depth);\n\tconst previouslyRendered = [];\n\twhile (renders.length) {\n\t\tconst { instance } = renders.shift()!;\n\t\tif (instanceMap.has(instance) && previouslyRendered.indexOf(instance) === -1) {\n\t\t\tpreviouslyRendered.push(instance);\n\t\t\tconst { parentVNode, dnode } = instanceMap.get(instance)!;\n\t\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\t\tconst nextSiblings = nextSiblingMap.get(instance)!;\n\t\t\tupdateDom(\n\t\t\t\tdnode,\n\t\t\t\ttoInternalWNode(instance, instanceData),\n\t\t\t\tprojectionOptions,\n\t\t\t\tparentVNode,\n\t\t\t\tinstance,\n\t\t\t\tnextSiblings,\n\t\t\t\tnextSiblings\n\t\t\t);\n\t\t}\n\t}\n\trunAfterRenderCallbacks(projectionOptions);\n\trunDeferredRenderCallbacks(projectionOptions);\n}\n\nexport const dom = {\n\tappend: function(\n\t\tparentNode: Element,\n\t\tinstance: DefaultWidgetBaseInterface,\n\t\tprojectionOptions: Partial<ProjectionOptions> = {}\n\t): Projection {\n\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\tconst finalProjectorOptions = getProjectionOptions(projectionOptions, instance);\n\t\tconst projectorState: ProjectorState = {\n\t\t\tafterRenderCallbacks: [],\n\t\t\tdeferredRenderCallbacks: [],\n\t\t\tnodeMap: new WeakMap(),\n\t\t\trenderScheduled: undefined,\n\t\t\trenderQueue: [],\n\t\t\tmerge: projectionOptions.merge || false,\n\t\t\tmergeElement: projectionOptions.mergeElement\n\t\t};\n\t\tprojectorStateMap.set(instance, projectorState);\n\n\t\tfinalProjectorOptions.rootNode = parentNode;\n\t\tconst parentVNode = toParentVNode(finalProjectorOptions.rootNode);\n\t\tconst node = toInternalWNode(instance, instanceData);\n\t\tinstanceMap.set(instance, { dnode: node, parentVNode });\n\t\tinstanceData.invalidate = () => {\n\t\t\tinstanceData.dirty = true;\n\t\t\tif (instanceData.rendering === false) {\n\t\t\t\tprojectorState.renderQueue.push({ instance, depth: finalProjectorOptions.depth });\n\t\t\t\tscheduleRender(finalProjectorOptions);\n\t\t\t}\n\t\t};\n\t\tupdateDom(node, node, finalProjectorOptions, parentVNode, instance, [], []);\n\t\tprojectorState.afterRenderCallbacks.push(() => {\n\t\t\tinstanceData.onAttach();\n\t\t});\n\t\trunDeferredRenderCallbacks(finalProjectorOptions);\n\t\trunAfterRenderCallbacks(finalProjectorOptions);\n\t\treturn {\n\t\t\tdomNode: finalProjectorOptions.rootNode\n\t\t};\n\t},\n\tcreate: function(instance: DefaultWidgetBaseInterface, projectionOptions?: Partial<ProjectionOptions>): Projection {\n\t\treturn this.append(document.createElement('div'), instance, projectionOptions);\n\t},\n\tmerge: function(\n\t\telement: Element,\n\t\tinstance: DefaultWidgetBaseInterface,\n\t\tprojectionOptions: Partial<ProjectionOptions> = {}\n\t): Projection {\n\t\tprojectionOptions.merge = true;\n\t\tprojectionOptions.mergeElement = element;\n\t\tconst projection = this.append(element.parentNode as Element, instance, projectionOptions);\n\t\tconst projectorState = projectorStateMap.get(instance)!;\n\t\tprojectorState.merge = false;\n\t\treturn projection;\n\t}\n};\n"]}